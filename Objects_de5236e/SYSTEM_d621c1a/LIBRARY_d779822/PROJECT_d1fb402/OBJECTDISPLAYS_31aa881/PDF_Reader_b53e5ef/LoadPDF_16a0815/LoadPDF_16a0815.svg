<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<svg height="604.53" version="1.2" width="1117.49" xmlns="http://www.w3.org/2000/svg" xmlns:atv="http://webmi.atvise.com/2007/svgext" xmlns:xlink="http://www.w3.org/1999/xlink">
 <defs/>
 <metadata>
  <atv:parameter behavior="optional" defaultvalue="id_3" desc="" name="frame" substitute="" valuetype="string"/>
  <atv:gridconfig enabled="false" gridstyle="lines" height="10" width="10"/>
  <atv:snapconfig enabled="true" height="5" width="5"/>
 </metadata>
 <g atv:insensitive="true" atv:refpx="0" atv:refpy="0" id="id_2">
  <rect atv:refpx="558.745" atv:refpy="302.265" fill="#1f1f1f" height="604.53" id="id_10" width="1117.49" x="0" y="0"/>
 </g>
 <svg atv:refpx="1024.969" atv:refpy="46.399" height="30" id="comboFilename" transform="matrix(1,0,0,1.3333,0,0)" width="160" x="945" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.combobox" y="30">
  <atv:argument name="itemsCount" value="10"/>
  <atv:argument name="fontSize" value="14"/>
  <atv:argument name="strokePressed" value="#177ddc"/>
  <atv:argument name="focusStrokeColor" value="#177ddc"/>
  <atv:argument name="valueFieldFillInactive" value="#177ddc"/>
  <atv:argument name="valueFieldFill" value="#177ddc"/>
  <atv:argument name="fontColor" value="SYSTEM.GLOBALS.plan.FontColor"/>
  <atv:argument name="fillColor" value="SYSTEM.GLOBALS.plan.BlueColor"/>
  <atv:argument name="symbolColor" value="SYSTEM.GLOBALS.plan.FontColor"/>
  <atv:argument name="borderColor" value="SYSTEM.GLOBALS.plan.BlueColor"/>
  <atv:argument name="statusIndication" value="SYSTEM.GLOBALS.plan.BlueColor"/>
  <atv:argument name="alarmIndication" value="SYSTEM.GLOBALS.plan.BlueColor"/>
  <atv:overwrite height="36" id="focus_frame" transform="matrix(1,0,0,0.75,0,0)"/>
  <atv:overwrite id="button_stroke" transform="matrix(1,0,0,0.75,0,0)" y="10"/>
  <atv:overwrite id="id_7" transform="matrix(1,0,0,0.75,0,0)" y="11"/>
  <atv:overwrite id="button_bg" transform="matrix(1,0,0,0.75,0,0)" y="10"/>
  <atv:overwrite id="combobox_label" transform="matrix(1,0,0,0.75,0,0)" y="24.5"/>
  <atv:overwrite height="32" id="blinking_frame" transform="matrix(1,0,0,0.75,0,0)"/>
  <atv:overwrite height="32" id="combobox_bg" transform="matrix(1,0,0,0.75,0,0)"/>
  <atv:overwrite height="38" id="id_1" transform="matrix(1,0,0,0.75,0,0)"/>
  <atv:overwrite height="40" id="id_0" transform="matrix(1,0,0,0.75,0,0)"/>
 </svg>
 <svg atv:refpx="464.234" atv:refpy="302.003" height="600" id="id_3" transform="matrix(1.1606,0,0,1.0067,0,0)" width="800" x="0" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.hmi.iframe" y="0">
  <atv:argument name="frameName" value="pdfFrame"/>
  <atv:argument name="isDefault" value="false"/>
  <atv:argument name="url" value="../../atviseDemoApplication.pdf"/>
 </svg>
 <svg atv:refpx="1035.414" atv:refpy="566.814" height="30" id="id_delete_PDF" transform="matrix(2,0,0,1.3333,0,0)" width="80" x="472.5" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.button" y="412.51">
  <atv:argument name="label" value="T{Удалить PDF}"/>
  <atv:argument name="fontColor" value="SYSTEM.GLOBALS.plan.FontColor"/>
  <atv:argument name="symbolColor" value="SYSTEM.GLOBALS.plan.FontColor"/>
  <atv:argument name="fillColor" value="SYSTEM.GLOBALS.plan.BlueColor"/>
  <atv:argument name="borderColor" value="SYSTEM.GLOBALS.plan.BlueColor"/>
  <atv:argument name="fontSize" value="16"/>
  <atv:overwrite id="button_symbol_bottom" transform="matrix(0.284,0,0,0.36,0,0)" x="130.667" y="42.96"/>
  <atv:overwrite id="button_symbol_top" transform="matrix(0.284,0,0,0.36,0,0)" x="130.667" y="21.627"/>
  <atv:overwrite height="37.999" id="id_6" transform="matrix(0.5,0,0,0.75,0,0)" width="158"/>
  <atv:overwrite id="button_symbol" transform="matrix(0.5,0,0,0.75,0,0)" x="70" y="9.999"/>
  <atv:overwrite id="button_label_2" transform="matrix(0.5,0,0,0.75,0,0)" x="80" y="31.499"/>
  <atv:overwrite id="button_label_1" transform="matrix(0.5,0,0,0.75,0,0)" x="80" y="16.499"/>
  <atv:overwrite id="button_label" transform="matrix(0.5,0,0,0.75,0,0)" x="80" y="24.499"/>
  <atv:overwrite height="35.999" id="button_stroke" transform="matrix(0.5,0,0,0.75,0,0)" width="156"/>
  <atv:overwrite height="37.999" id="button_bg" transform="matrix(0.5,0,0,0.75,0,0)" width="158"/>
  <atv:overwrite height="39.999" id="outer_frame" transform="matrix(0.5,0,0,0.75,0,0)" width="160"/>
 </svg>
 <text atv:refpx="1008.5" atv:refpy="16.5" fill="#ffffff" font-family="Arial" font-size="20" font-weight="bold" id="id_5" x="950" y="23.5">Выбор PDF:</text>
 <svg atv:refpx="1115.355" atv:refpy="445.785" height="137" id="id_4" width="163.73" x="945" xlink:href="SYSTEM.LIBRARY.PROJECT.OBJECTDISPLAYS.UPLOAD.Upload_vova_vers" y="405">
  <atv:argument name="frame" value="main_frame"/>
 </svg>
 <script type="text/ecmascript"><![CDATA[var filename;
var default_path;

webMI.data.subscribe("AGENT.OBJECTS.PDF_View.Directory_Path",function(e) {
	default_path = e.value;
	
	var path = default_path.replace('/','\\').replace('/','\\').replace('/','\\').replace('/','\\').replace('/','\\').replace('/','\\');

	// reads all PDFs form directory and puts into combobox
	webMI.data.call("GET_FILES_FROM_DIRECTORY", {path: default_path}, function(e){
		webMI.trigger.fire("setItems", e, "comboFilename");
	});
})

// changing of combobox selection
webMI.trigger.connect("valuechanged", function(e) {
var id = "comboFilename";
	webMI.data.call("REPLACE_PDF", {name:e.value}, function(e){
		if(e.value == "NOT_EQUAL"){
			webMI.display.openUrl("../../atviseDemoApplication.pdf", webMI.query, "pdfFrame");
		}
	});
	filename = e.value;
}, "comboFilename");


// Delete PDF function
webMI.addEvent("id_delete_PDF", "click", function (e) {
	var id = "id_delete_PDF";
	var value = true;
	return (function (value) {
		webMI.query.text_button_ok = "Удалить";
		webMI.query.text_button_cancel = "Отмена";
		webMI.query.top_text = "Действительно удалить данный PDF?";
		webMI.query.mode = "one";

		webMI.display.openWindow({
			display: "SYSTEM.LIBRARY.PROJECT.OBJECTDISPLAYS.Popups.popup_deletePDF",
			extern: false,
			height: 150,
			menubar: false,
			modal: true,
			moveable: false,
			resizable: false,
			scrollbars: false,
			status: false,
			title: "",
			toolbar: false,
			titlebar: false,
			width: 500,
			query: webMI.query
		});
	})(value);
});


webMI.trigger.connect("delete_pdf", function (e) {
	webMI.data.call("DELETE_PDF", { Address: filename, mode:"one"}, function (e) {
		if (e.result) {
			console.log("PDF deleted");
			
			webMI.data.call("REPLACE_PDF", {name:""}, function(e){
				if(e.value == "NOT_EQUAL"){
					webMI.display.openUrl("../../atviseDemoApplication.pdf", webMI.query, "pdfFrame");
				}
			});
			filename = "";
			
			webMI.data.call("GET_FILES_FROM_DIRECTORY", {path: default_path}, function(e){
				webMI.trigger.fire("setItems", e, "comboFilename");
				webMI.trigger.fire("setSelectedItem", e[0].text, "comboFilename");
			});
			
		}
		else {
			console.log("Delete not possible!");
		}
	});
});]]></script>
</svg>
