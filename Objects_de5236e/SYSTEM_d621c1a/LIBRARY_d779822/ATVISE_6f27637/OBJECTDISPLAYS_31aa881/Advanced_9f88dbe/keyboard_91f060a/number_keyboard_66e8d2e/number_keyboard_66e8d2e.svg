<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<svg xmlns:atv="http://webmi.atvise.com/2007/svgext" xmlns:xlink="http://www.w3.org/1999/xlink" width="429" version="1.2" height="355.5" xmlns="http://www.w3.org/2000/svg">
 <defs>
  <linearGradient x2="1" gradientUnits="objectBoundingBox" y1="-0.0183441" id="linear_12" y2="1" x1="1">
   <stop stop-color="#FAFAFA" offset="0"/>
   <stop stop-color="#FAFAFA" offset="1"/>
  </linearGradient>
 </defs>
 <desc>Provides an on-screen keyboard display for numerical input.</desc>
 <title>Numerical keyboard</title>
 <metadata>
  <atv:parameter defaultvalue="SYSTEM.GLOBALS.atvFontColor" desc="font color" name="fontColor" behavior="optional" substitute="$FONTCOLOR$" valuetype="global" group="Appearance"/>
  <atv:parameter defaultvalue="SYSTEM.GLOBALS.atvFillColor" desc="fill color" name="fillColor" behavior="optional" substitute="$FILLCOLOR$" valuetype="global" group="Appearance"/>
  <atv:parameter defaultvalue="" desc="unit" name="unit" behavior="optional" substitute="$unit$" valuetype="address"/>
  <atv:parameter defaultvalue="" desc="value" name="value" behavior="optional" substitute="$value$" valuetype="address"/>
  <atv:parameter desc="minimum" name="minValue" behavior="optional" valuetype="number"/>
  <atv:parameter desc="maximum" name="maxValue" behavior="optional" valuetype="number"/>
  <atv:parameter desc="digits before point" name="digitsBeforePoint" behavior="optional" valuetype="number"/>
  <atv:parameter desc="digits after point" name="digitsAfterPoint" behavior="optional" valuetype="number"/>
  <atv:parameter desc="Target" name="target" behavior="optional" valuetype="address"/>
  <atv:parameter desc="query confirm" name="queryConfirm" behavior="optional" valuetype="string"/>
  <atv:parameter defaultvalue="T{Do you really want to set the value?}" desc="query confirm text" name="queryConfirmText" behavior="optional" valuetype="trstring"/>
  <atv:parameter defaultvalue="No" desc="password mode" config="Yes;No" name="password" behavior="optional" valuetype="enum"/>
  <atv:parameter desc="trigger to be fired" name="trigger" behavior="optional" valuetype="string"/>
  <atv:gridconfig width="20" gridstyle="lines" enabled="false" height="20"/>
  <atv:snapconfig width="10" enabled="false" height="10"/>
 </metadata>
 <rect y="0" width="428.915" atv:refpx="214.499" height="75" fill="$FILLCOLOR$" stroke="none" x="0.041" ry="0" rx="0" id="id_0" atv:refpy="37.5"/>
 <text y="50" font-weight="bold" text-anchor="end" atv:dynamic="true" font-family="Arial" atv:refpx="414" font-size="36" fill="#000000" x="414.5" id="textValue" atv:refpy="37.5">$value$ $unit$</text>
 <rect y="75" width="107" atv:refpx="60.498" height="70" fill="url(#linear_12)" stroke="#646464" x="0.5" id="btn7" stroke-width="1" atv:refpy="110"/>
 <text y="122.5" font-weight="bold" font-family="Arial" atv:refpx="60.5" font-size="36" fill="$FONTCOLOR$" x="44" id="text7" atv:refpy="35">7</text>
 <rect y="75" width="107" atv:refpx="413.375" height="70" fill="url(#linear_12)" stroke="#646464" x="107.5" id="btn8" stroke-width="1" atv:refpy="786.275"/>
 <text y="122.5" font-weight="bold" font-family="Arial" atv:refpx="167.5" font-size="36" fill="$FONTCOLOR$" x="151" id="text8" atv:refpy="110">8</text>
 <rect y="75" width="107" atv:refpx="274.5" height="70" fill="url(#linear_12)" stroke="#646464" x="214.5" id="btn9" stroke-width="1" atv:refpy="35"/>
 <text y="122.5" font-weight="bold" font-family="Arial" atv:refpx="274.5" font-size="36" fill="$FONTCOLOR$" x="258" id="text9" atv:refpy="35">9</text>
 <rect y="145" width="107" atv:refpx="60.498" height="70" fill="url(#linear_12)" stroke="#646464" x="0.5" id="btn4" stroke-width="1" atv:refpy="105"/>
 <text y="192.5" font-weight="bold" font-family="Arial" atv:refpx="60.5" font-size="36" fill="$FONTCOLOR$" x="44" id="text4" atv:refpy="105">4</text>
 <rect y="145" width="107" atv:refpx="167.5" height="70" fill="url(#linear_12)" stroke="#646464" x="107.5" id="btn5" stroke-width="1" atv:refpy="105"/>
 <text y="192.5" font-weight="bold" font-family="Arial" atv:refpx="167.5" font-size="36" fill="$FONTCOLOR$" x="151" id="text5" atv:refpy="105">5</text>
 <rect y="145" width="107" atv:refpx="274.5" height="70" fill="url(#linear_12)" stroke="#646464" x="214.5" id="btn6" stroke-width="1" atv:refpy="105"/>
 <text y="192.5" font-weight="bold" font-family="Arial" atv:refpx="274.5" font-size="36" fill="$FONTCOLOR$" x="258" id="text6" atv:refpy="105">6</text>
 <rect y="145" width="107" atv:refpx="381.5" height="70" fill="url(#linear_12)" stroke="#646464" x="321.5" id="btnCancel" stroke-width="1" atv:refpy="180"/>
 <text y="192.5" font-weight="bold" font-family="Arial" atv:refpx="381.5" font-size="36" fill="$FONTCOLOR$" x="363" id="textCancel" atv:refpy="180">X</text>
 <rect y="215" width="107" atv:refpx="60.498" height="70" fill="url(#linear_12)" stroke="#646464" x="0.5" id="btn1" stroke-width="1" atv:refpy="175"/>
 <text y="262.5" font-weight="bold" font-family="Arial" atv:refpx="60.5" font-size="36" fill="$FONTCOLOR$" x="44" id="text1" atv:refpy="175">1</text>
 <rect y="215" width="107" atv:refpx="167.5" height="70" fill="url(#linear_12)" stroke="#646464" x="107.5" id="btn2" stroke-width="1" atv:refpy="175"/>
 <text y="262.5" font-weight="bold" font-family="Arial" atv:refpx="167.5" font-size="36" fill="$FONTCOLOR$" x="151" id="text2" atv:refpy="175">2</text>
 <rect y="215" width="107" atv:refpx="274.5" height="70" fill="url(#linear_12)" stroke="#646464" x="214.5" id="btn3" stroke-width="1" atv:refpy="175"/>
 <text y="262.5" font-weight="bold" font-family="Arial" atv:refpx="274.5" font-size="36" fill="$FONTCOLOR$" x="258" id="text3" atv:refpy="175">3</text>
 <rect y="215" width="107" atv:refpx="381.5" height="140" fill="url(#linear_12)" stroke="#646464" x="321.5" id="btnOk" stroke-width="1" atv:refpy="285"/>
 <polyline points="356.645,287.807 370.327,302.761 392.914,267.238" atv:refpx="381.28" fill="$FONTCOLOR$" stroke="$FONTCOLOR$" fill-opacity="0" id="id_6" stroke-width="6" atv:refpy="285"/>
 <rect y="285" width="107" atv:refpx="60.498" height="70" fill="url(#linear_12)" stroke="#646464" x="0.5" id="btnMinus" stroke-width="1" atv:refpy="245"/>
 <text y="332.5" font-weight="bold" font-family="Arial" atv:refpx="60.5" font-size="36" fill="$FONTCOLOR$" x="44" id="textMinus" atv:refpy="245">-</text>
 <rect y="285" width="107" atv:refpx="167.5" height="70" fill="url(#linear_12)" stroke="#646464" x="107.5" id="btn0" stroke-width="1" atv:refpy="245"/>
 <text y="332.5" font-weight="bold" font-family="Arial" atv:refpx="167.5" font-size="36" fill="$FONTCOLOR$" x="151" id="text0" atv:refpy="245">0</text>
 <rect y="285" width="107" atv:refpx="274.5" height="70" fill="url(#linear_12)" stroke="#646464" x="214.5" id="btnComma" stroke-width="1" atv:refpy="245"/>
 <text y="332.5" font-weight="bold" font-family="Arial" atv:refpx="274.5" font-size="36" fill="$FONTCOLOR$" x="258" id="textComma" atv:refpy="245">.</text>
 <rect y="75" width="107" atv:refpx="381.5" height="70" fill="url(#linear_12)" stroke="#646464" x="321.5" id="btnDel" stroke-width="1" atv:refpy="110"/>
 <polyline points="391.834,101 391.834,119 367.834,119 357.834,110 367.834,101 391.834,101" atv:refpx="405.683" fill="$FONTCOLOR$" stroke="none" id="id_3" stroke-width="2" atv:refpy="94.1"/>
 <line x2="383.936" y1="106.513" atv:refpx="418.211" stroke="#FAFAFA" id="id_4" y2="113.487" stroke-width="1.374" atv:refpy="188.732" x1="375.201"/>
 <line x2="375.201" y1="106.513" atv:refpx="418.211" stroke="#FAFAFA" id="id_5" y2="113.487" stroke-width="1.374" atv:refpy="188.732" x1="383.936"/>
 <g atv:refpx="214.5" id="id_2" atv:refpy="215">
  <rect y="75" atv:dynamic="true" width="107" atv:refpx="54" height="70" fill="#1c7eff" stroke="none" x="0.5" fill-opacity="0" id="seven" atv:refpy="185"/>
  <rect y="75" atv:dynamic="true" width="107" atv:refpx="161.5" height="70" fill="#1c7eff" stroke="none" x="107.5" fill-opacity="0" id="eight" atv:refpy="110"/>
  <rect y="75" atv:dynamic="true" width="107" atv:refpx="482.5" height="70" fill="#1c7eff" stroke="none" x="214.5" fill-opacity="0" id="nine" atv:refpy="110"/>
  <rect y="145" atv:dynamic="true" width="107" atv:refpx="54" height="70" fill="#1c7eff" stroke="none" x="0.5" fill-opacity="0" id="four" atv:refpy="325"/>
  <rect y="145" atv:dynamic="true" width="107" atv:refpx="161" height="70" fill="#1c7eff" stroke="none" x="107.5" fill-opacity="0" id="five" atv:refpy="325"/>
  <rect y="145" atv:dynamic="true" width="107" atv:refpx="482.5" height="70" fill="#1c7eff" stroke="none" x="214.5" fill-opacity="0" id="six" atv:refpy="180"/>
  <rect y="145" atv:dynamic="true" width="107" atv:refpx="696.5" height="70" fill="#1c7eff" stroke="none" x="321.5" fill-opacity="0" id="cancel" atv:refpy="180"/>
  <rect y="215" atv:dynamic="true" width="107" atv:refpx="54" height="70" fill="#1c7eff" stroke="none" x="0.5" fill-opacity="0" id="one" atv:refpy="465"/>
  <rect y="215" atv:dynamic="true" width="107" atv:refpx="161" height="70" fill="#1c7eff" stroke="none" x="107.5" fill-opacity="0" id="two" atv:refpy="465"/>
  <rect y="215" atv:dynamic="true" width="107" atv:refpx="268" height="70" fill="#1c7eff" stroke="none" x="214.5" fill-opacity="0" id="three" atv:refpy="465"/>
  <rect y="215" atv:dynamic="true" width="107" atv:refpx="696.06" height="140" fill="#1c7eff" stroke="none" x="321.28" fill-opacity="0" id="ok" atv:refpy="250"/>
  <rect y="285" atv:dynamic="true" width="107" atv:refpx="54" height="70" fill="#1c7eff" stroke="none" x="0.5" fill-opacity="0" id="minus" atv:refpy="605"/>
  <rect y="285" atv:dynamic="true" width="107" atv:refpx="161" height="70" fill="#1c7eff" stroke="none" x="107.5" fill-opacity="0" id="zero" atv:refpy="605"/>
  <rect y="285" atv:dynamic="true" width="107" atv:refpx="268" height="70" fill="#1c7eff" stroke="none" x="214.5" fill-opacity="0" id="comma" atv:refpy="605"/>
  <rect y="75" atv:dynamic="true" width="107" atv:refpx="696.5" height="70" fill="#1c7eff" stroke="none" x="321.5" fill-opacity="0" id="del" atv:refpy="110"/>
 </g>
 <script type="text/ecmascript"><![CDATA[var q = webMI.query;
var actualText;
var decSeparator = '.';
var hoverColor = '#0531f2';
var numbers = [
	'minValue', 'maxValue', 'digitsBeforePoint', 'digitsAfterPoint'
];
var isOkButtonEnabled = false;

function setButtonEnabled(button, value) {
	isOkButtonEnabled = value;
	webMI.gfx.setFill(button, value ? "url(#linear_12)" : "#c8c8c8");
}

function isValid(value) {
	if (isNaN(value))
		return false;
	if (!isNaN(q.maxValue) && value > q.maxValue)
		return false;
	if (!isNaN(q.minValue) && value < q.minValue)
		return false;

	return true;
}

function makeStars(length) {
	return new Array(length + 1).join("*");
}

function setText(text) {
	actualText = text;

	if (text !== undefined && webMI.query["password"] == "Yes")
		text = makeStars(cutUnit(text).length) + q.unit;

	webMI.gfx.setText("textValue", text);
}

for (var i in numbers)
	q[numbers[i]] = parseFloat(q[numbers[i]]);

q.unit = (q.unit != "") ? " " + q.unit : q.unit;

setButtonEnabled("btnOk", isValid(
	parseFloat(webMI.query.value)
));
setText(webMI.query.value + " " + webMI.query.unit);

function cutUnit(text) {
	if (q.unit.length == 0) return text;
	return text.substr(0, text.indexOf(q.unit));
}

var mousedowns = [
	'zero', 'one', 'two', 'three', 'four',
	'five', 'six', 'seven', 'eight', 'nine'
];

var mouseFunction = function(mouse, group, color) {
	var _func = function(e) {
		if (group == "ok" && !isOkButtonEnabled)
			return;

		webMI.gfx.setFillOpacity(group, color);
	};

	webMI.addEvent(group, mouse, _func);

	if (mouse == 'mouseup')
		webMI.addEvent(group, 'mouseout', _func);
};

var setFunction = function (group, item, number) {

	webMI.addEvent(group, 'click', function(e) {
		var val = cutUnit(actualText) + number;
		var minus = (val.indexOf('-') == -1) ? 0 : 1;
		var indexOfDec = val.indexOf(decSeparator);
		var digitsAfter = val.substr(indexOfDec + 1).length;
		var digitsBefore = val.substr(minus, indexOfDec - minus).length;

		if (indexOfDec == -1) {
			digitsBefore = digitsAfter - minus;
			digitsAfter = 0;
		}

		if (digitsBefore > q.digitsBeforePoint || digitsAfter > q.digitsAfterPoint)
			return;

		setButtonEnabled("btnOk", isValid(
			parseFloat(val)
		));
		setText(val + q.unit);
	});

};

for (var i=0; i < mousedowns.length; i++) {
	mouseFunction('mousedown', mousedowns[i], 0.5);
	mouseFunction('mouseup', mousedowns[i], 0);
	setFunction(mousedowns[i], 'btn' + i, i);
}

mouseFunction('mousedown', 'cancel', 0.5);
mouseFunction('mousedown', 'ok', 0.5);
mouseFunction('mousedown', 'minus', 0.5);
mouseFunction('mousedown', 'comma', 0.5);
//mouseFunction('mousedown', 'del', 0.5);

var delDown;

webMI.addEvent('del', 'mousedown', function(e) {
	webMI.gfx.setFillOpacity('del', 0.5);
	delDown = setTimeout(function() {
		setButtonEnabled("btnOk", false);
		setText(' ' + q.unit);
	}, 1500);
});

mouseFunction('mouseup', 'cancel', 0);
mouseFunction('mouseup', 'ok', 0);
mouseFunction('mouseup', 'minus', 0);
mouseFunction('mouseup', 'comma', 0);
//mouseFunction('mouseup', 'del', 0);

var delMouseUp = function(e) {
	webMI.gfx.setFillOpacity('del', 0);
	clearTimeout(delDown);
};

webMI.addEvent('del', 'mouseup', delMouseUp);
webMI.addEvent('del', 'mouseout', delMouseUp);

webMI.addEvent('minus', 'click', function(e) {
	var textValue = cutUnit(actualText);
	var value = (-1) * parseFloat(textValue);

	if (isNaN(value))
		return;

	setButtonEnabled("btnOk", isValid(value));
	setText(value + q.unit);
});



webMI.addEvent('del', 'click', function(e) {
	var text = cutUnit(actualText);
	text = text.substr(0, text.length-1) + q.unit;

	setButtonEnabled("btnOk", isValid(
		parseFloat(text)
	));
	setText(text);
});



webMI.addEvent('cancel', 'click', function(e) {
	webMI.display.closeWindow();
});



webMI.addEvent('ok', 'click', function(e) {
	if (!isOkButtonEnabled)
		return;

	if (q.queryConfirm == 'true' && !confirm(q.queryConfirmText)) return;

	var value = parseFloat(cutUnit(actualText));

	if (q.target != undefined) {
		webMI.data.write(q.target, value);
	}

	webMI.trigger.fire("valuechanged", value, "");

	if (q.trigger)
		webMI.trigger.fire(q.trigger, value);

	webMI.display.closeWindow();
});



webMI.addEvent('comma', 'click', function(e) {
	var textValue = cutUnit(actualText);

	if (textValue.indexOf(decSeparator) == -1) textValue += decSeparator;

	setText(textValue + q.unit);
});



]]></script>
</svg>
