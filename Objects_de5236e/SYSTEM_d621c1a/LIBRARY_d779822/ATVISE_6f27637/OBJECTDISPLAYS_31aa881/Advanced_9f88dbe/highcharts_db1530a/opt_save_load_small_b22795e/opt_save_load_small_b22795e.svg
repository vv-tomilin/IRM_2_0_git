<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<svg xmlns:atv="http://webmi.atvise.com/2007/svgext" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="800" version="1.2" height="300">
 <defs>
  <linearGradient x2="0" gradientUnits="objectBoundingBox" id="linear_2" y2="1.07843" y1="0" x1="0">
   <stop offset="0" stop-color="#818181"/>
   <stop offset="0.8475336322869955" stop-color="#464646"/>
   <stop offset="0.9372197309417041" stop-color="#000000"/>
  </linearGradient>
 </defs>
 <desc>Small display variant</desc>
 <title>Configuration - Save/Load</title>
 <metadata>
  <atv:parameter name="load_right" config="SYSTEM.SECURITY.RIGHTS" valuetype="address" desc="necessary right" defaultvalue="" group="Security: load configuration" behavior="optional"/>
  <atv:parameter name="load_activeNode" valuetype="address" desc="activation address" group="Security: load configuration" behavior="optional"/>
  <atv:parameter name="load_activeValue" valuetype="string" desc="activation value" group="Security: load configuration" behavior="optional"/>
  <atv:parameter name="save_right" config="SYSTEM.SECURITY.RIGHTS" valuetype="address" desc="necessary right" defaultvalue="" group="Security: save configuration" behavior="optional"/>
  <atv:parameter name="save_activeNode" valuetype="address" desc="activation address" group="Security: save configuration" behavior="optional"/>
  <atv:parameter name="save_activeValue" valuetype="string" desc="activation value" group="Security: save configuration" behavior="optional"/>
  <atv:parameter name="save_changecompression" valuetype="bool" desc="change compression" defaultvalue="false" group="Security: save configuration" behavior="optional"/>
  <atv:parameter name="fontColor" valuetype="global" desc="font color" defaultvalue="SYSTEM.GLOBALS.atvFontColor" group="Appearance" substitute="$FONTCOLOR$" behavior="optional"/>
  <atv:parameter name="fillColor" valuetype="global" desc="fill color" defaultvalue="SYSTEM.GLOBALS.atvFillColor" group="Appearance" substitute="$FILLCOLOR$" behavior="optional"/>
  <atv:gridconfig width="20" enabled="true" height="20" gridstyle="lines"/>
  <atv:snapconfig width="5" enabled="true" height="5"/>
 </metadata>
 <svg xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.button" x="651.001" y="79" atv:refpy="70" width="80" atv:refpx="670.001" id="btn_save" height="30">
  <atv:argument value="T{Save}" name="label"/>
  <atv:argument value="22" name="tabIndex"/>
  <atv:argument name="right" prefix="save_right"/>
  <atv:argument name="activeNode" prefix="save_activeNode"/>
  <atv:argument name="activeValue" prefix="save_activeValue"/>
 </svg>
 <svg xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.button" x="651" y="200" atv:refpy="317" width="80" atv:refpx="670" id="btn_delete" height="30">
  <atv:argument value="T{Delete}" name="label"/>
  <atv:argument value="26" name="tabIndex"/>
  <atv:argument name="right" prefix="save_right"/>
  <atv:argument name="activeNode" prefix="save_activeNode"/>
  <atv:argument name="activeValue" prefix="save_activeValue"/>
 </svg>
 <svg xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.button" x="411" y="200" atv:refpy="200" width="80" atv:refpx="430" id="btn_load" height="30">
  <atv:argument value="T{Load}" name="label"/>
  <atv:argument value="24" name="tabIndex"/>
  <atv:argument name="right" prefix="load_right"/>
  <atv:argument name="activeNode" prefix="load_activeNode"/>
  <atv:argument name="activeValue" prefix="load_activeValue"/>
 </svg>
 <text x="204.5" text-anchor="start" fill="$FONTCOLOR$" font-family="Arial" y="99" atv:refpy="94.5" atv:refpx="284" id="id_8" font-size="12">T{Save current configuration?}:
    </text>
 <svg xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.in_out_value" x="279.839" y="79" atv:refpy="70" width="160" transform="matrix(1.4687,0,0,1,0,0)" atv:refpx="507.497" id="save_name" height="30">
  <atv:argument value="String" name="validation"/>
  <atv:argument value="21" name="tabIndex"/>
  <atv:argument name="right" prefix="save_right"/>
  <atv:argument name="activeNode" prefix="load_activeNode"/>
  <atv:argument value="" name="activeValue" prefix="load_activeValue"/>
  <atv:overwrite width="229.492" transform="matrix(0.6809,0,0,1,0,0)" id="id_2"/>
  <atv:overwrite x="227.047" transform="matrix(0.6809,0,0,1,0,0)" id="input_label"/>
  <atv:overwrite transform="matrix(0.6809,0,0,1,0,0)" width="226.992" id="blinking_frame"/>
  <atv:overwrite transform="matrix(0.6809,0,0,1,0,0)" width="230.992" id="focus_frame"/>
  <atv:overwrite transform="matrix(0.6809,0,0,1,0,0)" width="226.992" id="input_bg"/>
  <atv:overwrite transform="matrix(0.6809,0,0,1,0,0)" width="232.992" id="id_1"/>
  <atv:overwrite transform="matrix(0.6809,0,0,1,0,0)" width="234.992" id="id_0"/>
 </svg>
 <text x="204.5" text-anchor="start" fill="$FONTCOLOR$" font-family="Arial" y="132" atv:refpy="127.5" atv:refpx="341.5" id="id_11" font-size="12">T{Load or delete existing configuration from node}:
    </text>
 <text x="569.5" text-anchor="middle" fill="$FONTCOLOR$" font-family="Arial" y="189" atv:refpy="184.5" atv:refpx="569.5" id="id_15" font-size="12">T{Attention: Unsaved changes will be lost!}
    </text>
 <svg xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.button" x="531" y="200" atv:refpy="317" width="80" atv:refpx="550" id="btn_refresh" height="30">
  <atv:argument value="T{Refresh}" name="label"/>
  <atv:argument value="25" name="tabIndex"/>
  <atv:argument name="right" prefix="load_right"/>
  <atv:argument name="activeNode" prefix="load_activeNode"/>
  <atv:argument name="activeValue" prefix="load_activeValue"/>
 </svg>
 <rect x="0" fill="$FILLCOLOR$" ry="0" y="0" atv:refpy="19.811" stroke-width="0" width="180" atv:refpx="86.25" id="filters_bg" stroke="#000000" rx="0" height="300"/>
 <svg xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.combobox" x="205.49" y="141" atv:refpy="130" width="160" transform="matrix(2.0001,0,0,1,0,0)" atv:refpx="549.996" id="cbb_configs" height="30">
  <atv:overwrite x="294.766" transform="matrix(0.5,0,0,1,0,0)" id="id_3"/>
  <atv:overwrite x="292.516" transform="matrix(0.5,0,0,1,0,0)" id="id_5"/>
  <atv:overwrite width="288.016" transform="matrix(0.5,0,0,1,0,0)" id="id_2"/>
  <atv:overwrite width="319.516" transform="matrix(0.5,0,0,1,0,0)" id="combobox_stroke"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="316.016" id="focus_frame"/>
  <atv:overwrite x="295.016" transform="matrix(0.5,0,0,1,0,0)" id="button_stroke"/>
  <atv:overwrite x="295.016" transform="matrix(0.5,0,0,1,0,0)" id="id_7"/>
  <atv:overwrite x="295.016" transform="matrix(0.5,0,0,1,0,0)" id="button_bg"/>
  <atv:overwrite x="285.516" transform="matrix(0.5,0,0,1,0,0)" id="combobox_label"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="288.016" id="blinking_frame"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="288.016" id="combobox_bg"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="318.016" id="id_1"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="320.016" id="id_0"/>
 </svg>
 <text x="204.5" text-anchor="start" fill="$FONTCOLOR$" font-family="Arial" y="25" atv:refpy="20.5" atv:refpx="265.5" id="text_nodeOrFile" font-size="12">T{Configuration node}:
    </text>
 <text x="204.5" text-anchor="start" fill="$FONTCOLOR$" font-family="Arial" y="271" atv:refpy="266.5" atv:refpx="281.5" id="id_4" font-size="12">T{Create new configuration}:
    </text>
 <svg xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.button" x="651" y="250" atv:refpy="240" width="80" atv:refpx="670" id="btn_create" height="30">
  <atv:argument value="T{Create}" name="label"/>
  <atv:argument value="31" name="tabIndex"/>
  <atv:argument name="right" prefix="save_right"/>
  <atv:argument name="activeNode" prefix="save_activeNode"/>
  <atv:argument name="activeValue" prefix="save_activeValue"/>
 </svg>
 <svg xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.in_out_value" x="279.839" y="250" atv:refpy="240" width="160" transform="matrix(1.4687,0,0,1,0,0)" atv:refpx="507.499" id="new_name" height="30">
  <atv:argument value="String" name="validation"/>
  <atv:argument value="30" name="tabIndex"/>
  <atv:argument name="right" prefix="save_right"/>
  <atv:argument name="activeNode" prefix="load_activeNode"/>
  <atv:argument value="" name="activeValue" prefix="load_activeValue"/>
  <atv:overwrite width="229.492" transform="matrix(0.6809,0,0,1,0,0)" id="id_2"/>
  <atv:overwrite x="227.047" transform="matrix(0.6809,0,0,1,0,0)" id="input_label"/>
  <atv:overwrite transform="matrix(0.6809,0,0,1,0,0)" width="226.992" id="blinking_frame"/>
  <atv:overwrite transform="matrix(0.6809,0,0,1,0,0)" width="230.992" id="focus_frame"/>
  <atv:overwrite transform="matrix(0.6809,0,0,1,0,0)" width="226.992" id="input_bg"/>
  <atv:overwrite transform="matrix(0.6809,0,0,1,0,0)" width="232.992" id="id_1"/>
  <atv:overwrite transform="matrix(0.6809,0,0,1,0,0)" width="234.992" id="id_0"/>
 </svg>
 <text x="14.5" text-anchor="start" fill="#575757" font-family="Arial" y="60" atv:refpy="55.5" atv:refpx="48.5" id="text_method" font-size="12">T{Save in}: -</text>
 <text x="14.5" text-anchor="start" font-weight="bold" fill="#575757" font-family="Arial" y="35" atv:refpy="30.5" atv:refpx="45.5" id="id_19" font-size="12">T{Settings}:
    </text>
 <svg xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.checkbox" x="14" y="70" atv:refpy="90" width="160" atv:refpx="90" id="check_compression" height="30">
  <atv:argument value="T{Compression}" name="label"/>
  <atv:argument value="true" name="outputValueOn"/>
  <atv:argument value="false" name="outputValueOff"/>
  <atv:argument value="true" name="valueOn"/>
  <atv:argument value="1" name="tabIndex"/>
 </svg>
 <svg xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.in_out_value" x="205.5" y="33" atv:refpy="49" width="160" transform="matrix(2,0,0,1,0,0)" atv:refpx="550" id="picker_config_file" height="30">
  <atv:argument value="12" name="tabIndex"/>
  <atv:argument value="String" name="validation"/>
  <atv:overwrite x="312.055" transform="matrix(0.5,0,0,1,0,0)" id="input_label"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="312" id="blinking_frame"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="316" id="focus_frame"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="312" id="input_bg"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="318" id="id_1"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="320" id="id_0"/>
 </svg>
 <svg xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.picker_address" x="205.51" y="33" atv:refpy="35" width="160" transform="matrix(1.9999,0,0,1,0,0)" atv:refpx="549.981" id="picker_config_address" height="30">
  <atv:overwrite x="292.49" transform="matrix(0.5,0,0,1,0,0)" id="id_5"/>
  <atv:overwrite width="319.49" transform="matrix(0.5,0,0,1,0,0)" id="addresspicker_stroke"/>
  <atv:argument value="10" name="tabIndex"/>
  <atv:overwrite x="291.984" transform="matrix(0.5,0,0,1,0,0)" id="addresspicker_clickarea"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="315.984" id="focus_frame"/>
  <atv:overwrite x="294.984" transform="matrix(0.5,0,0,1,0,0)" id="button_stroke"/>
  <atv:overwrite x="294.734" transform="matrix(0.5,0,0,1,0,0)" id="id_1"/>
  <atv:overwrite x="294.984" transform="matrix(0.5,0,0,1,0,0)" id="button_bg"/>
  <atv:overwrite x="285.984" transform="matrix(0.5,0,0,1,0,0)" id="input_label"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="287.984" id="blinking_frame"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="287.984" id="addresspicker_bg"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="317.984" id="id_0"/>
  <atv:overwrite transform="matrix(0.5,0,0,1,0,0)" width="319.984" id="id_2"/>
 </svg>
 <script type="text/ecmascript"><![CDATA[var newConfigName;
var selectedConfigName;
var createConfigName;
var chartname = webMI.query.chartname;
var chart = webMI.trendFactory.getTrendByName(chartname);
var configNode = chart.chart.options.atviseOptions.configNode;
var configFile = chart.chart.options.atviseOptions.configFile;
var configName = chart.chart.options.atviseOptions.configName;
var options = chart.chart.options;
var configurator;

//Falls neue Eingabe, neuer Aufruf der Auswahlfunktion
if (document.getElementById('fileInput'))
	document.getElementById('fileInput').addEventListener('change', uploadFile, false);

webMI.addOnload(function () {
	newConfigName = configName ? configName : "";

	if (options.atviseOptions.saveMethod == "multiple") {
		webMI.gfx.setText("text_method", "T{Save in}: T{Multiple nodes}");
		webMI.gfx.setText("text_nodeOrFile", "T{Configuration node (sub-nodes will be created automatically)}:");
		webMI.gfx.setVisible("picker_config_address", true);
		webMI.gfx.setVisible("picker_config_file", false);
	} else if (options.atviseOptions.saveMethod == "filesystem") {
		webMI.gfx.setText("text_method", "T{Save in}: T{Filesystem}");
		webMI.gfx.setText("text_nodeOrFile", "T{Configuration file (in filesystem)}:");
		webMI.gfx.setVisible("picker_config_address", false);
		webMI.gfx.setVisible("picker_config_file", true);
	} else {
		webMI.gfx.setText("text_method", "T{Save in}: T{Single node}");
		webMI.gfx.setText("text_nodeOrFile", "T{Configuration node}:");
		webMI.gfx.setVisible("picker_config_address", true);
		webMI.gfx.setVisible("picker_config_file", false);
	}

	webMI.trigger.fire("setChecked", options.atviseOptions.saveCompressed, "check_compression");
	webMI.gfx.setVisible("check_compression", (webMI.query.save_changecompression == "true") ? true : false);

	webMI.trigger.connect("valuechanged", function (e) {
		options.atviseOptions.saveCompressed = (e.value == "true") ? true : false;
	}, "check_compression");

	webMI.data.loadScript("highcharts/helpers/confighandler.js", function () {

		configurator = new webMI.rootWindow.ConfigHandler();

		webMI.trigger.connect("com.atvise.highcharts.save_confirm", function (e) {
			saveConfig(configurator);
			e.value.webMI.display.closeWindow();
		});

		webMI.trigger.connect("com.atvise.highcharts.create_confirm", function (e) {
			createConfig(configurator);
			e.value.webMI.display.closeWindow();
		});

		webMI.trigger.connect("com.atvise.highcharts.save_abort", function (e) {
			e.value.webMI.display.closeWindow();
		});

		webMI.trigger.connect("clicked", function (e) {
			var loadConfiguration = {
				"saveName": chart.chart.options.atviseOptions.saveMethod == "filesystem" ? chart.chart.options.atviseOptions.configFile : chart.chart.options.atviseOptions.configNode,
				"saveMethod": chart.chart.options.atviseOptions.saveMethod,
			}
			configurator.getConfigsFromNode(loadConfiguration.saveName, loadConfiguration.saveMethod, function (chartConfig) {
				if (newConfigName != "" && newConfigName in chartConfig) {
					webMI.display.openWindow({
						display: "SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.dialogs.message_dialog",
						height: 300,
						width: 400,
						modal: true,
						resizable: false,
						movable: true,
						scrollbars: false,
						menubar: false,
						status: false,
						toolbar: false,
						query: {
							headline: "T{Overwrite existing configuration?}",
							msg1: "T{Actual configuration name already exist.}",
							msg2: "T{Do you want to overwrite the configuration?}",
							msg3: "",
							btn1: "T{Overwrite}",
							btn2: "T{Abort}",
							action_btn1: "com.atvise.highcharts.save_confirm",
							action_btn2: "com.atvise.highcharts.save_abort"
						}
					});
				} else {
					saveConfig(configurator);
				}
			});
		}, "btn_save");

		webMI.trigger.connect("clicked", function (e) {
			var id = "btn_load";
			var value = true;
			return function (value) {
				if (selectedConfigName == undefined || selectedConfigName == "")
					return alert("T{Please select a configuration!}");

				var loadConfiguration = {
					"saveName": chart.chart.options.atviseOptions.saveMethod == "filesystem" ? chart.chart.options.atviseOptions.configFile : chart.chart.options.atviseOptions.configNode,
					"saveMethod": chart.chart.options.atviseOptions.saveMethod,
				}
				configurator.loadConfig(loadConfiguration.saveName, loadConfiguration.saveMethod, selectedConfigName, function (chartConfig) {
					/*reset chart*/
					while (chart.chart.series.length > 0)
						chart.chart.series[0].remove();
					while (chart.chart.xAxis.length > 0)
						chart.chart.xAxis[0].remove();
					while (chart.chart.yAxis.length > 0)
						chart.chart.yAxis[0].remove();

					/*update chart*/
					for (var i = 0; i < chartConfig.xAxis.length; i++)
						chart.chart.addAxis(chartConfig.xAxis[i], true);
					for (var i = 0; i < chartConfig.yAxis.length; i++)
						chart.chart.addAxis(chartConfig.yAxis[i], false);
					for (var i = 0; i < chartConfig.series.length; i++)
						chart.chart.addSeries(chartConfig.series[i]);

					chart.chart.options.atviseOptions = chartConfig.atviseOptions;

					webMI.trigger.fire("setValue", chart.chart.options.atviseOptions.configName, "save_name");
					webMI.trigger.fire("setChecked", chart.chart.options.atviseOptions.saveCompressed, "check_compression");

					chart.chart.update(chartConfig);
					chart.control.updated();
				});
			}(value);
		}, "btn_load");

		webMI.trigger.connect("clicked", function (e) {
			if (createConfigName == undefined || createConfigName == "")
				return alert("T{Please enter a configuration name!}");

			var loadConfiguration = {
				"saveName": chart.chart.options.atviseOptions.saveMethod == "filesystem" ? chart.chart.options.atviseOptions.configFile : chart.chart.options.atviseOptions.configNode,
				"saveMethod": chart.chart.options.atviseOptions.saveMethod,
			}
			configurator.getConfigsFromNode(loadConfiguration.saveName, loadConfiguration.saveMethod, function (chartConfig) {
				if (createConfigName in chartConfig) {
					webMI.display.openWindow({
						display: "SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.dialogs.message_dialog",
						height: 300,
						width: 400,
						modal: true,
						resizable: false,
						movable: true,
						scrollbars: false,
						menubar: false,
						status: false,
						toolbar: false,
						query: {
							headline: "T{Overwrite existing configuration?}",
							msg1: "T{Actual configuration name already exist.}",
							msg2: "T{Do you want to overwrite the configuration?}",
							msg3: "",
							btn1: "T{Overwrite}",
							btn2: "T{Abort}",
							action_btn1: "com.atvise.highcharts.create_confirm",
							action_btn2: "com.atvise.highcharts.save_abort"
						}
					});
				} else {
					webMI.trigger.fire("com.atvise.highcharts.getQuickSave", "getState");
				}
			});
		}, "btn_create");

		/* check for unsaved configs */
		webMI.trigger.connect("com.atvise.highcharts.sendQuickSave", function (e) {
			if(e.value){
				webMI.display.openWindow({
					display: "SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.dialogs.message_dialog",
					height: 300,
					width: 400,
					modal: true,
					resizable: false,
					movable: true,
					scrollbars: false,
					menubar: false,
					status: false,
					toolbar: false,
					query: {
						headline: "T{Save current configuration?}",
						msg1: "T{The current configuration is not saved yet!}",
						msg2: "T{Do you still want to create the new configuration?}",
						msg3: "",
						btn1: "T{Yes}",
						btn2: "T{Abort}",
						action_btn1: "com.atvise.highcharts.create_confirm",
						action_btn2: "com.atvise.highcharts.save_abort"
					}
				});
			} else {
				createConfig(configurator);
			}
		});


		webMI.trigger.connect("clicked", function (e) {
			loadConfigsForNode(configurator);
		}, "btn_refresh");


        webMI.trigger.connect("clicked", function (e) {
            var id = "btn_delete";
            var value = true;
            return function (value) {
                var menuObj = [];

                if (configNode == undefined || configNode == "")
                    return alert("T{Config node required!}");

                if (selectedConfigName == undefined || selectedConfigName == "")
                    return alert("T{Please select a configuration name!}");

                configurator.deleteConfig(configNode, selectedConfigName, chart, function (chartConfig) {
                    for (var i in chartConfig) {
                        menuObj.push({text: i, value: i});
                    }

                    webMI.trigger.fire("setItems", menuObj, "cbb_configs");
                    webMI.trigger.fire("setSelectedItem", name, "cbb_configs");
                    //webMI.trigger.fire("setValue", name, "in_config");
					chart.control.updated();
                });
            }(value);
        }, "btn_delete");

        webMI.trigger.connect("valuechanged", function (e) {
            newConfigName = e.value;
        }, "save_name");

        webMI.trigger.connect("valuechanged", function (e) {
            createConfigName = e.value;
        }, "new_name");

        webMI.trigger.connect("valuechanged", function (e) {
            selectedConfigName = e.value;
        }, "cbb_configs");

        webMI.trigger.connect("valuechanged", function (e) {
            configNode = e.value;
            loadConfigsForNode(configurator);
        }, "picker_config_address");

        webMI.trigger.connect("valuechanged", function (e) {
            configFile = e.value;
            // chart.chart.options.atviseOptions.configFile = configFile;
            loadConfigsForNode(configurator);
        }, "picker_config_file");

        webMI.trigger.connect("clicked", function (e) {
            var id = "json_download";
            var value = true;
            return function (value) {
                if (configNode == undefined)
                    return alert("T{Config node required!}");

				var loadConfiguration = {
					"saveName": chart.chart.options.atviseOptions.saveMethod == "filesystem" ? chart.chart.options.atviseOptions.configFile : chart.chart.options.atviseOptions.configNode,
					"saveMethod": chart.chart.options.atviseOptions.saveMethod,
				}
				configurator.getConfigsFromNode(loadConfiguration.saveName, loadConfiguration.saveMethod, function (chartConfig) {
					chartConfig = JSON.stringify(chartConfig);
                    webMI.callExtension("SYSTEM.LIBRARY.ATVISE.QUICKDYNAMICS.Save As", {
                        "content": chartConfig,
                        "name": "highcharts-config.json",
                        "type": "application/json"
                    });
                });

            }(value);
        }, "json_download");

	});

	webMI.trigger.fire("setValue", newConfigName, "save_name");
	webMI.trigger.fire("setValue", configNode, "picker_config_address");
	webMI.trigger.fire("setValue", configFile, "picker_config_file");
});

function loadConfigsForNode(configurator, configName) {
	var loadConfiguration = {
		"saveName": chart.chart.options.atviseOptions.saveMethod == "filesystem" ? chart.chart.options.atviseOptions.configFile : chart.chart.options.atviseOptions.configNode,
		"saveMethod": chart.chart.options.atviseOptions.saveMethod,
	}

	if(chart.chart.options.atviseOptions.saveMethod == "filesystem") {
		if(configFile != loadConfiguration.saveName){
			loadConfiguration.saveName = configFile;
			chart.chart.options.atviseOptions.configFile = configFile;
		}
	} else {
		if(configNode != loadConfiguration.saveName){
			loadConfiguration.saveName = configNode;
			chart.chart.options.atviseOptions.configNode = configNode;
		}
	}

	configurator.getConfigsFromNode(loadConfiguration.saveName, loadConfiguration.saveMethod, function (chartConfig) {
		var comboItems = [];
		for (var i in chartConfig) {
			comboItems.push({text: i, value: i});
		}

		webMI.trigger.fire("setItems", comboItems, "cbb_configs");
		if (configName && configName in chartConfig) {
			webMI.trigger.fire("setSelectedItem", configName, "cbb_configs");
		}
	});
}

function saveConfig(configurator) {
	var menuObj = [];

	if(chart.chart.options.atviseOptions.saveMethod == "filesystem") {
		if (configFile == undefined || configFile == "")
			return alert("T{Config file required!}");
	} else {
		if (configNode == undefined || configNode == "")
			return alert("T{Config node required!}");
	}

	if (newConfigName == undefined || newConfigName == "")
		return alert("T{Please enter a valid configuration name!}");

	configurator.saveConfigOrImport({"configNode" : configNode, "configName" : newConfigName},
	  chart,
	  function (chartConfig) {
		chart.control.updated();
		for (var i in chartConfig) {
			menuObj.push({text: i, value: i});
		}

		webMI.trigger.fire("setItems", menuObj, "cbb_configs");
		webMI.trigger.fire("setSelectedItem", name, "cbb_configs");
		//webMI.trigger.fire("setValue", name, "in_config");

		chart.chart.options.atviseOptions.configNode = configNode;
		chart.chart.options.atviseOptions.configName = newConfigName;
		chart.control.updated();
	});
}

function createConfig(configurator) {
	/*reset chart*/
	while (chart.chart.series.length > 0)
		chart.chart.series[0].remove();
	while (chart.chart.xAxis.length > 1)
		chart.chart.xAxis[1].remove();
	while (chart.chart.yAxis.length > 0)
		chart.chart.yAxis[0].remove();

	var xAxisOptions = {
		"title": {"text": ""},
		"timeSpan": 60,
		"timeSpanUnit": 1,
		"tickInterval": 10000,
		"lineWidth": 0,
		"labels": {
			"enabled": true,
			"align": "center"
		},
		"crosshair": {
			"width": 0,
			"snap": true,
			"color": "#FF0000",
			"dashStyle": "Solid"
		},
		"type": "datetime",
		"dateTimeLabelFormats": {
			"format": "%H:%M:%S"
		},
		"gridLineWidth": 1,
		"gridLineColor": "#888888",
		"minorGridLineWidth": 1,
		"minorGridLineColor": "#EEEEEE",
		"minorTickInterval": 10000,
		"opposite": false
	};

	chart.chart.xAxis[0].update(xAxisOptions);
	chart.chart.addAxis({}, false);
	chart.chart.addSeries();

	chart.chart.options.atviseOptions.configName = createConfigName;

	webMI.trigger.fire("setValue", chart.chart.options.atviseOptions.configName, "save_name");

	if (webMI.rootWindow.atviseDefaults)
		chart.chart.update(webMI.rootWindow.atviseDefaults);
	chart.control.updated(function () {
		saveConfig(configurator);
	});
}

function uploadFile(evt) {
	if (configNode == undefined)
		return alert("T{Config node required!}");

	if(configNode != chart.chart.options.atviseOptions.configNode){
		chart.chart.options.atviseOptions.configNode = configNode;
	}

	var files = evt.target.files;
	var uploadFile = files[0];

	var reader = new FileReader();
	reader.onload = function (fileData) {
		var fileText = fileData.target.result;
		// remove line breaks
		fileText = fileText.replace(/(\r\n|\n|\r)/gm, "");
		// remove multiple spaces
		fileText = fileText.replace(/\s\s+/g, ' ');
		// remove Tabs
		fileText = fileText.replace('\t', '')

		var configImport = JSON.parse(fileText);
		var keyList = Object.keys(configImport);

		if(keyList.indexOf("default") > -1)
            configName = "default";
		else
		    configName = keyList[0];

		saveImport(keyList, configNode, JSON.parse(fileText), function callback() {
			loadConfigsForNode(configurator, configName);
		})
	}

	reader.readAsText(uploadFile);
}

function saveImport(keyList, configNode, configImport, callback){

	if(keyList.length > 0){
		var key = keyList.shift();
		if(key != "autosave") {
			var current = JSON.parse(JSON.stringify(configImport[key]));
			var configOptions = {"configNode": configNode, "configName": key, "configImport" : current};
		    configurator.saveConfigOrImport(configOptions, chart, function(){
			    saveImport(keyList, configNode, configImport, callback);
		    });
		} else {
			saveImport(keyList, configNode, configImport, callback);
		}
	} else {
		callback();
	}
}

]]></script>
 <line x2="781" atv:refpy="67" stroke-width="0.5" atv:refpx="482.714" id="id_6" y2="71" y1="71" stroke="#d7d7d7" x1="201"/>
</svg>
