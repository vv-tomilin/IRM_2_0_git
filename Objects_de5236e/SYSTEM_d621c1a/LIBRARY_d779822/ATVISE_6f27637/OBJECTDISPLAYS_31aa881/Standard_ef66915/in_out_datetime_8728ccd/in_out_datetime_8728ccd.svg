<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<svg width="287" version="1.2" xmlns="http://www.w3.org/2000/svg" height="102" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:atv="http://webmi.atvise.com/2007/svgext">
 <defs>
  <linearGradient id="linear_12" y1="-0.0183441" x1="1" y2="1" gradientUnits="objectBoundingBox" x2="1">
   <stop offset="0" stop-color="#494949"/>
   <stop offset="1" stop-color="#000000"/>
  </linearGradient>
  <linearGradient id="linear_11" y1="1.00811" x1="0.0839607" y2="-0.0183441" gradientUnits="objectBoundingBox" x2="0.0839607">
   <stop offset="0" stop-color="#494949"/>
   <stop offset="1" stop-color="#000000"/>
  </linearGradient>
  <linearGradient id="linear_4" y1="1.00811" x1="0.0839607" y2="-0.0183441" gradientUnits="objectBoundingBox" x2="0.0839607">
   <stop offset="0" stop-color="#494949"/>
   <stop offset="1" stop-color="#000000"/>
  </linearGradient>
  <linearGradient id="linear_2" y1="1.00811" x1="0.0839607" y2="-0.0183441" gradientUnits="objectBoundingBox" x2="0.0839607">
   <stop offset="0" stop-color="#494949"/>
   <stop offset="1" stop-color="#000000"/>
  </linearGradient>
  <linearGradient id="linear_0" y1="1.00811" x1="0.0839607" y2="-0.0183441" gradientUnits="objectBoundingBox" x2="0.0839607">
   <stop offset="0" stop-color="#494949"/>
   <stop offset="1" stop-color="#000000"/>
  </linearGradient>
  <linearGradient id="linear_1" y1="1.00811" x1="0.0839607" y2="-0.0183441" gradientUnits="objectBoundingBox" x2="0.0839607">
   <stop offset="0" stop-color="#494949"/>
   <stop offset="1" stop-color="#000000"/>
  </linearGradient>
  <linearGradient id="linear_5" y1="1.00811" x1="0.0839607" y2="-0.0183441" gradientUnits="objectBoundingBox" x2="0.0839607">
   <stop offset="0" stop-color="#494949"/>
   <stop offset="1" stop-color="#000000"/>
  </linearGradient>
  <linearGradient id="linear_7" y1="1.00811" x1="0.0839607" y2="-0.0183441" gradientUnits="objectBoundingBox" x2="0.0839607">
   <stop offset="0" stop-color="#494949"/>
   <stop offset="1" stop-color="#000000"/>
  </linearGradient>
  <linearGradient id="linear_10" y1="1.00811" x1="0.0839607" y2="-0.0183441" gradientUnits="objectBoundingBox" x2="0.0839607">
   <stop offset="0" stop-color="#494949"/>
   <stop offset="1" stop-color="#000000"/>
  </linearGradient>
  <linearGradient id="linear_14" y1="1.00811" x1="0.0839607" y2="-0.0183441" gradientUnits="objectBoundingBox" x2="0.0839607">
   <stop offset="0" stop-color="#494949"/>
   <stop offset="1" stop-color="#000000"/>
  </linearGradient>
  <linearGradient id="linear_16" y1="-0.0183441" x1="1" y2="1" gradientUnits="objectBoundingBox" x2="1">
   <stop offset="0" stop-color="#ffffff" stop-opacity="0.2745098039215687"/>
   <stop offset="0.5515695067264574" stop-color="#ffffff" stop-opacity="0"/>
  </linearGradient>
  <linearGradient id="linear_17" y1="-0.0183441" x1="1" y2="1" gradientUnits="objectBoundingBox" x2="1">
   <stop offset="0" stop-color="#ffffff" stop-opacity="0.2745098039215687"/>
   <stop offset="0.5515695067264574" stop-color="#ffffff" stop-opacity="0"/>
  </linearGradient>
  <linearGradient id="linear_18" y1="-0.0183441" x1="1" y2="1" gradientUnits="objectBoundingBox" x2="1">
   <stop offset="0" stop-color="#ffffff" stop-opacity="0.2745098039215687"/>
   <stop offset="0.5515695067264574" stop-color="#ffffff" stop-opacity="0"/>
  </linearGradient>
  <linearGradient id="linear_19" y1="-0.0183441" x1="1" y2="1" gradientUnits="objectBoundingBox" x2="1">
   <stop offset="0" stop-color="#ffffff" stop-opacity="0.2745098039215687"/>
   <stop offset="0.5515695067264574" stop-color="#ffffff" stop-opacity="0"/>
  </linearGradient>
  <linearGradient id="linear_20" y1="-0.0183441" x1="1" y2="1" gradientUnits="objectBoundingBox" x2="1">
   <stop offset="0" stop-color="#ffffff" stop-opacity="0.2745098039215687"/>
   <stop offset="0.5515695067264574" stop-color="#ffffff" stop-opacity="0"/>
  </linearGradient>
  <linearGradient id="linear_21" y1="-0.0183441" x1="1" y2="1" gradientUnits="objectBoundingBox" x2="1">
   <stop offset="0" stop-color="#ffffff" stop-opacity="0.2745098039215687"/>
   <stop offset="0.5515695067264574" stop-color="#ffffff" stop-opacity="0"/>
  </linearGradient>
  <linearGradient id="linear_3" y1="-0.0183441" x1="1" y2="1" gradientUnits="objectBoundingBox" x2="1">
   <stop offset="0" stop-color="#494949"/>
   <stop offset="1" stop-color="#000000"/>
  </linearGradient>
 </defs>
 <desc>Sets/displays date and time.</desc>
 <title>In/Out Date-Time</title>
 <metadata>
  <atv:parameter desc="base" valuetype="address" behavior="mandatory" name="base"/>
  <atv:parameter desc="format" config="dd.mm.yyyy;mm.dd.yyyy" valuetype="enum" behavior="optional" name="format" defaultvalue="dd.mm.yyyy"/>
  <atv:parameter desc="interval [ms] (0 = off)" valuetype="number" behavior="optional" name="interval" defaultvalue="150"/>
  <atv:parameter desc="family" config="Times New Roman=Times New Roman,Bodoni,Garamond,Minion Web,ITC Stone Serif,MS Georgia,Bitstream Cyberbit,serif;Arial=MS Trebuchet,ITC Avant Garde Gothic,MS Arial,MS Verdana,Univers,Futura,ITC Stone Sans,Gill Sans,Akzidenz Grotesk,Helvetica,sans-serif;Courier=Courier,MS Courier New,Prestige,Everson Mono,monospace;Zapf-Chancery=Caflisch Script,Adobe Poetica,Sanvito,Ex Ponto,Snell Roundhand,Zapf-Chancery,cursive;Alpha Geometrique=Alpha Geometrique,Critter,Cottonwood,FB Reactor,Studz,fantasy" valuetype="enum" group="Font" behavior="optional" name="fontFamily" defaultvalue="Arial"/>
  <atv:parameter desc="size" config="6;7;8;9;10;11;12;14;16;18" valuetype="enum" group="Font" behavior="optional" name="fontSize" defaultvalue="12"/>
  <atv:parameter desc="color" valuetype="color" group="Font" behavior="optional" name="fontColor" defaultvalue="#000000"/>
  <atv:parameter desc="fill color text" valuetype="color" group="Appearance" behavior="optional" name="valueFill" defaultvalue="#d0d0d0"/>
  <atv:parameter desc="fill color button" valuetype="color" group="Appearance" behavior="optional" name="buttonFill" defaultvalue="#000000"/>
  <atv:parameter desc="fill color arrow" valuetype="color" group="Appearance" behavior="optional" name="arrowFill" defaultvalue="#d0d0d0"/>
  <atv:parameter desc="fill color arrow pressed" valuetype="color" group="Appearance" behavior="optional" name="arrowFillPressed" defaultvalue="#FDFF0F"/>
  <atv:parameter desc="fill color when inactive" valuetype="color" group="Appearance" behavior="optional" name="fillColorInactive" defaultvalue="#8c8c8c"/>
  <atv:parameter desc="stroke color button pressed" valuetype="color" group="Appearance" behavior="optional" name="buttonStrokePressed" defaultvalue="#ffffff"/>
  <atv:parameter desc="focus stroke color" valuetype="color" group="Appearance" behavior="optional" name="focusStrokeColor" defaultvalue="#FFFFFF"/>
  <atv:parameter desc="minimum date" valuetype="string" group="Options" behavior="optional" name="minDate"/>
  <atv:parameter desc="maximum date" valuetype="string" group="Options" behavior="optional" name="maxDate"/>
  <atv:parameter desc="minimum time" valuetype="string" group="Options" behavior="optional" name="minTime"/>
  <atv:parameter desc="maximum time" valuetype="string" group="Options" behavior="optional" name="maxTime"/>
  <atv:parameter desc="address to set" valuetype="address" group="Options" behavior="optional" name="outputNode"/>
  <atv:parameter desc="consistency group" valuetype="string" group="Options" behavior="optional" name="consistencyGroup"/>
  <atv:parameter desc="tab index" valuetype="number" group="Options" behavior="optional" name="tabIndex"/>
  <atv:parameter desc="tooltip" valuetype="trstring" group="Options" behavior="optional" name="tooltip"/>
  <atv:parameter desc="necessary right" config="SYSTEM.SECURITY.RIGHTS" valuetype="address" group="Security" behavior="optional" name="right"/>
  <atv:parameter desc="activation address" valuetype="address" group="Security" behavior="optional" name="activeNode"/>
  <atv:parameter desc="activation value" valuetype="string" group="Security" behavior="optional" name="activeValue"/>
 </metadata>
 <rect width="286.5" x="0.25" y="0.25" fill="url(#linear_3)" atv:dynamic="true" rx="1.5" height="101.5" ry="1.5" stroke="#646464" id="id_2" atv:refpx="81" stroke-width="0.5" atv:refpy="50"/>
 <svg width="122" x="1" y="1" height="100" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Standard.in_out_date" id="date" atv:refpx="62" atv:refpy="50">
  <atv:argument prefix="interval" value="" name="interval"/>
  <atv:argument prefix="fontColor" value="" name="fontColor"/>
  <atv:argument prefix="buttonFill" value="" name="buttonFill"/>
  <atv:argument prefix="arrowFill" value="" name="arrowFill"/>
  <atv:argument prefix="arrowFillPressed" value="" name="arrowFillPressed"/>
  <atv:argument prefix="buttonStrokePressed" value="" name="buttonStrokePressed"/>
  <atv:argument prefix="right" value="" name="right"/>
  <atv:argument prefix="activeNode" value="" name="activeNode"/>
  <atv:argument prefix="activeValue" value="" name="activeValue"/>
  <atv:argument prefix="valueFill" value="" name="valueFill"/>
  <atv:argument prefix="fillColorInactive" value="" name="fillColorInactive"/>
  <atv:argument prefix="fontFamily" value="" name="fontFamily"/>
  <atv:argument prefix="fontSize" value="" name="fontSize"/>
  <atv:argument prefix="outputNode" value="" name="outputNode"/>
  <atv:argument prefix="format" value="" name="format"/>
  <atv:argument prefix="minDate" value="" name="min"/>
  <atv:argument prefix="maxDate" value="" name="max"/>
  <atv:argument prefix="tabIndex" value="" name="tabIndex"/>
  <atv:argument prefix="focusStrokeColor" value="" name="focusStrokeColor"/>
  <atv:argument prefix="tooltip" value="" name="tooltip"/>
 </svg>
 <svg width="162" x="124" y="1" height="100" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Standard.in_out_time" id="time" atv:refpx="205" atv:refpy="51">
  <atv:argument prefix="interval" value="" name="interval"/>
  <atv:argument prefix="fontColor" value="" name="fontColor"/>
  <atv:argument prefix="buttonFill" value="" name="buttonFill"/>
  <atv:argument prefix="arrowFill" value="" name="arrowFill"/>
  <atv:argument prefix="arrowFillPressed" value="" name="arrowFillPressed"/>
  <atv:argument prefix="buttonStrokePressed" value="" name="buttonStrokePressed"/>
  <atv:argument prefix="right" value="" name="right"/>
  <atv:argument prefix="activeNode" value="" name="activeNode"/>
  <atv:argument prefix="activeValue" value="" name="activeValue"/>
  <atv:argument prefix="valueFill" value="" name="valueFill"/>
  <atv:argument prefix="fillColorInactive" value="" name="fillColorInactive"/>
  <atv:argument prefix="fontFamily" value="" name="fontFamily"/>
  <atv:argument prefix="fontSize" value="" name="fontSize"/>
  <atv:argument prefix="outputNode" value="" name="outputNode"/>
  <atv:argument prefix="minTime" value="" name="min"/>
  <atv:argument prefix="maxTime" value="" name="max"/>
  <atv:argument prefix="fillColorInactive" value="" name="fillColorInactive"/>
  <atv:argument prefix="tabIndex" value="" name="tabIndex"/>
  <atv:argument prefix="focusStrokeColor" value="" name="focusStrokeColor"/>
  <atv:argument prefix="tooltip" value="" name="tooltip"/>
 </svg>
 <script type="text/ecmascript"><![CDATA[//connect to valuechanged-triggers
webMI.trigger.connect("valuechanged", function(e) { 
		setDate(e.value); 
		webMI.trigger.fire("updateDate", _value, "time"); 
		valueUpdated(true); }, "date");
webMI.trigger.connect("valuechanged", function(e) { 
		setDate(e.value); 
		webMI.trigger.fire("updateTime", _value, "date"); 
		valueUpdated(true); }, "time");

//connect to setValue-trigger
webMI.trigger.connect("setValue", function(e) {
	update(e.value);
});

//parameters
var base = (webMI.query["base"] == undefined) ? "" : webMI.query["base"];
var outputNode = webMI.query["outputNode"];
var consistencyGroup = webMI.query["consistencyGroup"];

//parameters passed through or not used in script
// var format = webMI.query["format"];
// var min = webMI.query["min"];
// var max = webMI.query["max"];
// var interval = parseFloat(webMI.query["interval"]);
// var fontFamily = webMI.query["fontFamily"];
// var fontSize = webMI.query["fontSize"];
// var fontColor = webMI.query["fontColor"];
// var buttonFill = webMI.query["buttonFill"];
// var arrowFill = webMI.query["arrowFill"];
// var arrowFillPressed = webMI.query["arrowFillPressed"];
// var buttonStrokePressed = webMI.query["buttonStrokePressed"];
// var right = webMI.query["right"];
// var activeNode = webMI.query["activeNode"];
// var activeValue = webMI.query["activeValue"];

//variables
var _value = new Date().getTime();

if (consistencyGroup)
	var consistencyHandler = webMI.callExtension("SYSTEM.LIBRARY.ATVISE.QUICKDYNAMICS.Consistency Handler");

//subscribe to node
if (base != "") {
	if (consistencyGroup) {
		consistencyHandler.register(consistencyGroup, base, update);
	} else {
		webMI.data.subscribe(base, function(e) {
			setDate(e.value);
			updateDisplay();
		});
	}
//no base defined
} else {
	//display initial value
	updateDisplay();
}

/*
 * FUNCTIONS
 */

//update display
function updateDisplay() {
	webMI.trigger.fire("setValue", _value, "date");
	webMI.trigger.fire("setValue", _value, "time");
}

//set date
function setDate(date) {
	_value = date;
}

//value has been changed by display
function valueUpdated(fireTrigger) {
	//update node
	if (base != "" && !consistencyGroup) {
		webMI.data.write(base, _value);
	}

	if (outputNode) {
		webMI.data.write(outputNode, _value);
	}
	
	//fire trigger
	if (fireTrigger) {
		webMI.trigger.fire("valuechanged", _value, "");
	}

	//update consistency value
	if (consistencyGroup)
		consistencyHandler.set(consistencyGroup, base, _value);
}

//update externally by trigger or consistency handler
function update(value) {
	setDate(value);
	//valueUpdated(false);

	//update displayed values only
	if ((base == "") || (base == undefined) || consistencyGroup) {
		updateDisplay();
	}
}]]></script>
</svg>
