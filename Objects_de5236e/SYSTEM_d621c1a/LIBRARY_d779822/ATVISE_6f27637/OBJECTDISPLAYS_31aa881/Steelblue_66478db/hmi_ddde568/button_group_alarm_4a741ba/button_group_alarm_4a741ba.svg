<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<svg width="160" version="1.2" xmlns="http://www.w3.org/2000/svg" height="45" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:atv="http://webmi.atvise.com/2007/svgext">
 <defs>
  <linearGradient id="linear_12" y1="0.970149" x1="0.119403" y2="-0.0159425" gradientUnits="objectBoundingBox" x2="0.119403">
   <stop offset="0" stop-color="#29394b"/>
   <stop offset="1" stop-color="#788ba3"/>
  </linearGradient>
  <linearGradient id="linear_0" y1="-0.0159425" x1="0.776844" y2="0.940299" gradientUnits="objectBoundingBox" x2="0.776844">
   <stop offset="0" stop-color="#1a242f"/>
   <stop offset="1" stop-color="#71849c"/>
  </linearGradient>
  <linearGradient id="linear_1" y1="-0.0183441" x1="1" y2="1" gradientUnits="objectBoundingBox" x2="1">
   <stop offset="0" stop-color="#ffffff" stop-opacity="0.2745098039215687"/>
   <stop offset="0.5515695067264574" stop-color="#ffffff" stop-opacity="0"/>
  </linearGradient>
  <linearGradient id="linear_2" y1="1" y2="-0.0183441" x1="1" x2="1" gradientUnits="objectBoundingBox">
   <stop offset="0" stop-color="#ffffff" stop-opacity="0.2745098039215687"/>
   <stop offset="0.5515695067264574" stop-color="#ffffff" stop-opacity="0"/>
  </linearGradient>
 </defs>
 <desc>Display offers four alarm specified buttons.</desc>
 <title>Group Alarmbuttons</title>
 <metadata>
  <atv:parameter desc="alarm list display" valuetype="display" behavior="optional" name="alarmDisplay" defaultvalue="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Steelblue.hmi.alarmlist"/>
  <atv:parameter desc="target frame" valuetype="string" behavior="optional" name="targetFrame" defaultvalue="content"/>
  <atv:parameter desc="enable sound" valuetype="bool" behavior="optional" name="soundEnabled" defaultvalue="false"/>
  <atv:parameter desc="stroke color when pressed" valuetype="color" behavior="optional" name="strokePressed" defaultvalue="#ffffff"/>
 </metadata>
 <rect width="159.5" x="0.25" y="0.25" atv:bindtl="0,0" fill="url(#linear_12)" atv:dynamic="true" rx="3" height="44.5" ry="3" stroke="#646464" atv:bindbr="1,1" id="id_0" atv:refpx="80" stroke-width="0.5" atv:refpy="23.254"/>
 <rect width="154.5" x="2.75" y="2.75" atv:bindtl="0,0" fill="url(#linear_0)" rx="3" height="39.5" ry="3" stroke="none" atv:bindbr="1,1" id="id_2" atv:refpx="80" stroke-width="0.5" atv:refpy="22.5"/>
 <g atv:dynamic="true" id="clickarea_2" atv:refpx="60.753" atv:refpy="22.5" transform="matrix(1.074,0,0,1.074,-2.0829,-1.6641)">
  <rect width="34.452" x="41.283" y="5.274" atv:bindtl="0,0" fill="#495a6f" rx="3" height="34.452" ry="3" stroke="none" atv:bindbr="1,1" id="id_3" atv:refpx="99.791" stroke-width="0.766" atv:refpy="33.984"/>
  <svg width="20" x="28.21" y="4.694" height="20" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Symbols.20x20.alarm2" id="id_6" atv:refpx="101.704" atv:refpy="22.5" transform="matrix(1.5312,0,0,1.5312,0,0)">
   <atv:argument value="#ffffff" name="symbolColor"/>
  </svg>
  <rect width="34.452" x="41.283" y="5.274" atv:bindtl="0,0" fill="url(#linear_1)" rx="3" height="34.452" ry="3" stroke="none" atv:bindbr="1,1" id="button_stroke_2" atv:refpx="105.093" stroke-width="1" atv:refpy="22.501"/>
 </g>
 <g atv:dynamic="true" id="clickarea_1" atv:refpx="22.43" atv:refpy="22.5" transform="matrix(1.074,0,0,1.074,-1.7612,-1.6641)">
  <rect width="34.452" x="5.299" y="5.274" atv:bindtl="0,0" fill="#495a6f" rx="3" height="34.452" ry="3" stroke="none" atv:bindbr="1,1" id="button_bg" atv:refpx="28.121" stroke-width="0.766" atv:refpy="34.835"/>
  <svg width="20" x="4.71" y="4.694" height="20" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Symbols.20x20.stophorn" id="stophorn" atv:refpx="29.737" atv:refpy="22.5" transform="matrix(1.5312,0,0,1.5312,0,0)">
   <atv:argument value="#ffffff" name="symbolColor"/>
   <atv:argument value="#ffffff" name="fill"/>
  </svg>
  <svg width="20" x="4.71" y="4.694" height="20" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Symbols.20x20.starthorn" id="starthorn" atv:refpx="29.737" atv:refpy="22.5" transform="matrix(1.5312,0,0,1.5312,0,0)">
   <atv:argument value="#ffffff" name="symbolColor"/>
   <atv:argument value="#ffffff" name="fill"/>
  </svg>
  <rect width="34.452" x="5.299" y="5.274" atv:bindtl="0,0" fill="url(#linear_1)" rx="3" height="34.452" ry="3" stroke="none" atv:bindbr="1,1" id="button_stroke_1" atv:refpx="28.121" stroke-width="1" atv:refpy="22.501"/>
 </g>
 <g atv:dynamic="true" id="clickarea_4">
  <rect width="37.001" x="118.905" y="4" atv:bindtl="0,0" fill="#495a6f" rx="3.222" height="37.001" ry="3.222" stroke="none" atv:bindbr="1,1" id="id_10" atv:refpx="392.933" stroke-width="0.823" atv:refpy="49.587"/>
  <rect width="37.001" x="118.905" y="4" atv:bindtl="0,0" fill="url(#linear_1)" rx="3.222" height="37.001" ry="3.222" stroke="none" atv:bindbr="1,1" id="button_stroke_4" atv:refpx="381.162" stroke-width="1" atv:refpy="22.501"/>
  <svg width="20" x="73.554" y="3.682" height="20" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Symbols.20x20.alarm" id="id_15" atv:refpx="430.659" atv:refpy="22.501" transform="matrix(1.6445,0,0,1.6445,0,0)">
   <atv:argument value="#ffffff" name="symbolColor"/>
  </svg>
 </g>
 <g atv:dynamic="true" id="clickarea_3">
  <rect width="37.001" x="80.58" y="4" atv:bindtl="0,0" fill="#495a6f" rx="3.222" height="37.001" ry="3.222" stroke="none" atv:bindbr="1,1" id="id_7" atv:refpx="403.866" stroke-width="0.823" atv:refpy="51.695"/>
  <svg width="20" x="50.249" y="3.682" height="20" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Symbols.20x20.alarm3" id="id_9" atv:refpx="308.625" atv:refpy="22.501" transform="matrix(1.6445,0,0,1.6445,0,0)">
   <atv:argument value="#ffffff" name="symbolColor"/>
  </svg>
  <rect width="37.001" x="80.58" y="4" atv:bindtl="0,0" fill="url(#linear_1)" rx="3.222" height="37.001" ry="3.222" stroke="none" atv:bindbr="1,1" id="button_stroke_3" atv:refpx="264.79" stroke-width="1" atv:refpy="22.501"/>
 </g>
 <rect width="37.08" x="118.863" y="3.889" visibility="hidden" fill="none" rx="3" height="37.329" ry="3" stroke="#ff0004" id="alarm_stroke" atv:refpx="137.403" stroke-width="1" atv:refpy="22.553"/>
 <!--rect width="37" x="4" y="4" fill="#969696" rx="3" height="37" ry="3" stroke="none" fill-opacity="0.592" id="RC_INACTIVE" atv:refpx="22.5" stroke-width="1" atv:refpy="22.5"/-->
 <script type="text/ecmascript"><![CDATA[var frameName = webMI.query["targetFrame"];
var strokeNormal = "none";
var strokePressed = webMI.query["strokePressed"];
var alarmDisplay = webMI.query["alarmDisplay"];
var soundEnabled = (webMI.query["soundEnabled"]=="true");
var isAlarm = false;

webMI.addOnload(function(e) {
    webMI.rootWindow.webMI.callExtension("SYSTEM.LIBRARY.ATVISE.QUICKDYNAMICS.Alarmmanagement", {"id": ""});
	webMI.gfx.setVisible("starthorn",soundEnabled);
	webMI.gfx.setVisible("stophorn",!soundEnabled);
	webMI.trigger.fire("com.atvise.alarms_exist", setActive);
	webMI.trigger.connect("com.atvise.alarms_notify", function(e){
		setActive(e.value);
	});
});

function getSupportedAudio() {
    var myAudio = new Audio();
    var audioFile="/alarm.wav";

    if (typeof myAudio.canPlayType === "function" && myAudio.canPlayType("audio/mp4") !== "") {
        audioFile = "/alarm.m4a";
    } else if(typeof myAudio.canPlayType === "function" && myAudio.canPlayType("audio/ogg") !== "") {
        audioFile = "/alarm.ogg";
    }

    myAudio = null;
    return audioFile;
}

function setActive(activate){
	webMI.gfx.setVisible("alarm_stroke", activate ? {0:true,2:false,4:true,6:false,8:true,10:false} : false);
	if (soundEnabled && activate && !isAlarm)
		webMI.sound.play(getSupportedAudio(),0);
	else if (soundEnabled && !activate)
		webMI.sound.stop(getSupportedAudio());
	isAlarm = activate;
}

function acceptDisplay() {
	var currentDisplay = null;
	webMI.trigger.fire("getSource_" + frameName, function(e, currentDisplayWebMI) {
		if (e != null) {
			currentDisplayWebMI.alarm.acceptDisplay();
		}
	});
}

webMI.addEvent("clickarea_1", "mousedown", function(e) {
	var id = "clickarea_1";
	var value = true;
	return function(value) {
		webMI.gfx.setFill("button_stroke_1", "url(#linear_2)");
		webMI.gfx.setStroke("button_stroke_1", strokePressed);
	} (value);
});

webMI.addEvent("clickarea_1", "mouseup", function(e) {
	var id = "clickarea_1";
	var value = true;
	return function(value) {
		webMI.gfx.setFill("button_stroke_1", "url(#linear_1)");
		webMI.gfx.setStroke("button_stroke_1", strokeNormal);
	} (value);
});

webMI.addEvent("clickarea_1", "mouseout", function(e) {
	var id = "clickarea_1";
	var value = true;
	return function(value) {
		webMI.gfx.setFill("button_stroke_1", "url(#linear_1)");
		webMI.gfx.setStroke("button_stroke_1", strokeNormal);
	} (value);
});

webMI.addEvent("clickarea_1", "click", function(e) {
	var id = "clickarea_1";
	var value = true;
	return function(value) {
		if (isAlarm && soundEnabled){
			webMI.sound.stop(getSupportedAudio());
		}
		else if (isAlarm && !soundEnabled){
			webMI.sound.play(getSupportedAudio(),0);
		}
		soundEnabled = (soundEnabled)? false : true;
		webMI.gfx.setVisible("starthorn",soundEnabled);
		webMI.gfx.setVisible("stophorn",!soundEnabled);
	} (value);
});

webMI.addEvent("clickarea_2", "mousedown", function(e) {
	var id = "clickarea_2";
	var value = true;
	return function(value) {
		webMI.gfx.setFill("button_stroke_2", "url(#linear_2)");
		webMI.gfx.setStroke("button_stroke_2", strokePressed);
	} (value);
});

webMI.addEvent("clickarea_2", "mouseup", function(e) {
	var id = "clickarea_2";
	var value = true;
	return function(value) {
		webMI.gfx.setFill("button_stroke_2", "url(#linear_1)");
		webMI.gfx.setStroke("button_stroke_2", strokeNormal);
	} (value);
});

webMI.addEvent("clickarea_2", "mouseout", function(e) {
	var id = "clickarea_2";
	var value = true;
	return function(value) {
		webMI.gfx.setFill("button_stroke_2", "url(#linear_1)");
		webMI.gfx.setStroke("button_stroke_2", strokeNormal);
	} (value);
});

webMI.addEvent("clickarea_2", "click", function(e) {
	var id = "clickarea_2";
	var value = true;
	return function(value) {
		webMI.trigger.fire("com.atvise.alarms_next_display", true);
	} (value);
});

webMI.addEvent("clickarea_3", "mousedown", function(e) {
	var id = "clickarea_3";
	var value = true;
	return function(value) {
		webMI.gfx.setFill("button_stroke_3", "url(#linear_2)");
		webMI.gfx.setStroke("button_stroke_3", strokePressed);
	} (value);
});

webMI.addEvent("clickarea_3", "mouseup", function(e) {
	var id = "clickarea_3";
	var value = true;
	return function(value) {
		webMI.gfx.setFill("button_stroke_3", "url(#linear_1)");
		webMI.gfx.setStroke("button_stroke_3", strokeNormal);
	} (value);
});

webMI.addEvent("clickarea_3", "mouseout", function(e) {
	var id = "clickarea_3";
	var value = true;
	return function(value) {
		webMI.gfx.setFill("button_stroke_3", "url(#linear_1)");
		webMI.gfx.setStroke("button_stroke_3", strokeNormal);
	} (value);
});

webMI.addEvent("clickarea_3", "click", function(e) {
	var id = "clickarea_3";
	var value = true;
	return function(value) {
		acceptDisplay();
	} (value);
});


webMI.addEvent("clickarea_4", "mousedown", function(e) {
	var id = "clickarea_4";
	var value = true;
	return function(value) {
		webMI.gfx.setFill("button_stroke_4", "url(#linear_2)");
		webMI.gfx.setStroke("button_stroke_4", strokePressed);
	} (value);
});

webMI.addEvent("clickarea_4", "mouseup", function(e) {
	var id = "clickarea_4";
	var value = true;
	return function(value) {
		webMI.gfx.setFill("button_stroke_4", "url(#linear_1)");
		webMI.gfx.setStroke("button_stroke_4", strokeNormal);
	} (value);
});

webMI.addEvent("clickarea_4", "mouseout", function(e) {
	var id = "clickarea_4";
	var value = true;
	return function(value) {
		webMI.gfx.setFill("button_stroke_4", "url(#linear_1)");
		webMI.gfx.setStroke("button_stroke_4", strokeNormal);
	} (value);
});

webMI.addEvent("clickarea_4", "click", function(e) {
	var id = "clickarea_4";
	var value = true;
	return function(value) {
		webMI.display.openDisplay(alarmDisplay,webMI.query,frameName);
	} (value);
});]]></script>
</svg>
