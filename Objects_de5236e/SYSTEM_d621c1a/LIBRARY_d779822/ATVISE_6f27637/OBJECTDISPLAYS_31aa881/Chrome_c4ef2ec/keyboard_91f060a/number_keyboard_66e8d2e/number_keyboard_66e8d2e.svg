<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<svg width="429" version="1.2" xmlns="http://www.w3.org/2000/svg" height="355.5" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:atv="http://webmi.atvise.com/2007/svgext">
 <defs>
  <linearGradient id="linear_12" y1="0.0194118" x1="1" y2="1" gradientUnits="objectBoundingBox" x2="1">
   <stop offset="0" stop-color="#ffffff"/>
   <stop offset="0.3408071748878924" stop-color="#000000"/>
  </linearGradient>
 </defs>
 <desc>Provides an on-screen keyboard display for numerical input.</desc>
 <title>Numerical keyboard</title>
 <metadata>
  <atv:parameter valuetype="address" substitute="$unit$" behavior="optional" name="unit" defaultvalue=""/>
  <atv:parameter valuetype="address" substitute="$value$" behavior="optional" name="value" defaultvalue=""/>
  <atv:parameter desc="minimum" valuetype="number" behavior="optional" name="minValue"/>
  <atv:parameter desc="maximum" valuetype="number" behavior="optional" name="maxValue"/>
  <atv:parameter desc="digits before point" valuetype="number" behavior="optional" name="digitsBeforePoint"/>
  <atv:parameter desc="digits after point" valuetype="number" behavior="optional" name="digitsAfterPoint"/>
  <atv:parameter desc="Target" valuetype="address" behavior="optional" name="target"/>
  <atv:parameter desc="query confirm" valuetype="string" behavior="optional" name="queryConfirm"/>
  <atv:parameter desc="query confirm text" valuetype="trstring" behavior="optional" name="queryConfirmText" defaultvalue="T{Do you really want to set the value?}"/>
  <atv:parameter desc="password mode" config="Yes;No" valuetype="enum" behavior="optional" name="password" defaultvalue="No"/>
  <atv:parameter desc="trigger to be fired" valuetype="string" behavior="optional" name="trigger"/>
  <atv:gridconfig width="20" enabled="false" height="20" gridstyle="lines"/>
  <atv:snapconfig width="10" enabled="false" height="10"/>
 </metadata>
 <rect width="428.915" x="0.041" y="0" fill="#c8c8c8" rx="0" height="75" ry="0" stroke="none" id="id_0" atv:refpx="214.499" atv:refpy="37.5"/>
 <text x="414.5" y="50" atv:dynamic="true" fill="#000000" font-family="Arial" text-anchor="end" id="textValue" font-weight="bold" atv:refpx="414" atv:refpy="37.5" font-size="36">$value$ $unit$</text>
 <rect width="107" x="0.5" y="75" fill="url(#linear_12)" height="70" stroke="#646464" id="btn7" atv:refpx="60.498" stroke-width="1" atv:refpy="110"/>
 <text x="44" y="122.5" fill="#feffff" font-family="Arial" id="text7" font-weight="bold" atv:refpx="60.5" atv:refpy="35" font-size="36">7</text>
 <rect width="107" x="107.5" y="75" fill="url(#linear_12)" height="70" stroke="#646464" id="btn8" atv:refpx="413.375" stroke-width="1" atv:refpy="786.275"/>
 <text x="151" y="122.5" fill="#feffff" font-family="Arial" id="text8" font-weight="bold" atv:refpx="167.5" atv:refpy="110" font-size="36">8</text>
 <rect width="107" x="214.5" y="75" fill="url(#linear_12)" height="70" stroke="#646464" id="btn9" atv:refpx="274.5" stroke-width="1" atv:refpy="35"/>
 <text x="258" y="122.5" fill="#feffff" font-family="Arial" id="text9" font-weight="bold" atv:refpx="274.5" atv:refpy="35" font-size="36">9</text>
 <rect width="107" x="0.5" y="145" fill="url(#linear_12)" height="70" stroke="#646464" id="btn4" atv:refpx="60.498" stroke-width="1" atv:refpy="105"/>
 <text x="44" y="192.5" fill="#feffff" font-family="Arial" id="text4" font-weight="bold" atv:refpx="60.5" atv:refpy="105" font-size="36">4</text>
 <rect width="107" x="107.5" y="145" fill="url(#linear_12)" height="70" stroke="#646464" id="btn5" atv:refpx="167.5" stroke-width="1" atv:refpy="105"/>
 <text x="151" y="192.5" fill="#feffff" font-family="Arial" id="text5" font-weight="bold" atv:refpx="167.5" atv:refpy="105" font-size="36">5</text>
 <rect width="107" x="214.5" y="145" fill="url(#linear_12)" height="70" stroke="#646464" id="btn6" atv:refpx="274.5" stroke-width="1" atv:refpy="105"/>
 <text x="258" y="192.5" fill="#feffff" font-family="Arial" id="text6" font-weight="bold" atv:refpx="274.5" atv:refpy="105" font-size="36">6</text>
 <rect width="107" x="321.5" y="145" fill="url(#linear_12)" height="70" stroke="#646464" id="btnCancel" atv:refpx="381.5" stroke-width="1" atv:refpy="180"/>
 <text x="363" y="192.5" fill="#feffff" font-family="Arial" id="textCancel" font-weight="bold" atv:refpx="381.5" atv:refpy="180" font-size="36">X</text>
 <rect width="107" x="0.5" y="215" fill="url(#linear_12)" height="70" stroke="#646464" id="btn1" atv:refpx="60.498" stroke-width="1" atv:refpy="175"/>
 <text x="44" y="262.5" fill="#feffff" font-family="Arial" id="text1" font-weight="bold" atv:refpx="60.5" atv:refpy="175" font-size="36">1</text>
 <rect width="107" x="107.5" y="215" fill="url(#linear_12)" height="70" stroke="#646464" id="btn2" atv:refpx="167.5" stroke-width="1" atv:refpy="175"/>
 <text x="151" y="262.5" fill="#feffff" font-family="Arial" id="text2" font-weight="bold" atv:refpx="167.5" atv:refpy="175" font-size="36">2</text>
 <rect width="107" x="214.5" y="215" fill="url(#linear_12)" height="70" stroke="#646464" id="btn3" atv:refpx="274.5" stroke-width="1" atv:refpy="175"/>
 <text x="258" y="262.5" fill="#feffff" font-family="Arial" id="text3" font-weight="bold" atv:refpx="274.5" atv:refpy="175" font-size="36">3</text>
 <rect width="107" x="321.5" y="215" fill="url(#linear_12)" height="140" stroke="#646464" id="btnOk" atv:refpx="381.5" stroke-width="1" atv:refpy="285"/>
 <polyline points="356.645,287.807 370.327,302.761 392.914,267.238" fill="#ffffff" stroke="#ffffff" fill-opacity="0" id="id_6" atv:refpx="381.28" atv:refpy="285" stroke-width="6"/>
 <rect width="107" x="0.5" y="285" fill="url(#linear_12)" height="70" stroke="#646464" id="btnMinus" atv:refpx="60.498" stroke-width="1" atv:refpy="245"/>
 <text x="44" y="332.5" fill="#feffff" font-family="Arial" id="textMinus" font-weight="bold" atv:refpx="60.5" atv:refpy="245" font-size="36">-</text>
 <rect width="107" x="107.5" y="285" fill="url(#linear_12)" height="70" stroke="#646464" id="btn0" atv:refpx="167.5" stroke-width="1" atv:refpy="245"/>
 <text x="151" y="332.5" fill="#feffff" font-family="Arial" id="text0" font-weight="bold" atv:refpx="167.5" atv:refpy="245" font-size="36">0</text>
 <rect width="107" x="214.5" y="285" fill="url(#linear_12)" height="70" stroke="#646464" id="btnComma" atv:refpx="274.5" stroke-width="1" atv:refpy="245"/>
 <text x="258" y="332.5" fill="#feffff" font-family="Arial" id="textComma" font-weight="bold" atv:refpx="274.5" atv:refpy="245" font-size="36">.</text>
 <rect width="107" x="321.5" y="75" fill="url(#linear_12)" height="70" stroke="#646464" id="btnDel" atv:refpx="381.5" stroke-width="1" atv:refpy="110"/>
 <polyline points="391.834,101 391.834,119 367.834,119 357.834,110 367.834,101 391.834,101" fill="#ffffff" stroke="none" id="id_3" atv:refpx="405.683" atv:refpy="94.1" stroke-width="2"/>
 <line stroke="#151c26" id="id_4" y1="106.513" atv:refpx="418.211" x1="375.201" y2="113.487" atv:refpy="188.732" stroke-width="1.374" x2="383.936"/>
 <line stroke="#151c26" id="id_5" y1="106.513" atv:refpx="418.211" x1="383.936" y2="113.487" atv:refpy="188.732" stroke-width="1.374" x2="375.201"/>
 <g id="id_2" atv:refpx="214.5" atv:refpy="215">
  <rect width="107" x="0.5" y="75" atv:dynamic="true" fill="#1c7eff" height="70" stroke="none" fill-opacity="0" id="seven" atv:refpx="54" atv:refpy="185"/>
  <rect width="107" x="107.5" y="75" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="eight" atv:refpx="161.5" atv:refpy="110"/>
  <rect width="107" x="214.5" y="75" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="nine" atv:refpx="482.5" atv:refpy="110"/>
  <rect width="107" x="0.5" y="145" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="four" atv:refpx="54" atv:refpy="325"/>
  <rect width="107" x="107.5" y="145" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="five" atv:refpx="161" atv:refpy="325"/>
  <rect width="107" x="214.5" y="145" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="six" atv:refpx="482.5" atv:refpy="180"/>
  <rect width="107" x="321.5" y="145" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="cancel" atv:refpx="696.5" atv:refpy="180"/>
  <rect width="107" x="0.5" y="215" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="one" atv:refpx="54" atv:refpy="465"/>
  <rect width="107" x="107.5" y="215" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="two" atv:refpx="161" atv:refpy="465"/>
  <rect width="107" x="214.5" y="215" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="three" atv:refpx="268" atv:refpy="465"/>
  <rect width="107" x="321.28" y="215" fill="#1c7eff" atv:dynamic="true" height="140" stroke="none" fill-opacity="0" id="ok" atv:refpx="696.06" atv:refpy="250"/>
  <rect width="107" x="0.5" y="285" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="minus" atv:refpx="54" atv:refpy="605"/>
  <rect width="107" x="107.5" y="285" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="zero" atv:refpx="161" atv:refpy="605"/>
  <rect width="107" x="214.5" y="285" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="comma" atv:refpx="268" atv:refpy="605"/>
  <rect width="107" x="321.5" y="75" fill="#1c7eff" atv:dynamic="true" height="70" stroke="none" fill-opacity="0" id="del" atv:refpx="696.5" atv:refpy="110"/>
 </g>
 <script type="text/ecmascript"><![CDATA[var q = webMI.query;
var actualText;
var decSeparator = '.';
var hoverColor = '#0531f2';
var numbers = [
	'minValue', 'maxValue', 'digitsBeforePoint', 'digitsAfterPoint'
];
var isOkButtonEnabled = false;

function setButtonEnabled(button, value) {
	isOkButtonEnabled = value;
	webMI.gfx.setFill(button, value ? "url(#linear_12)" : "#c8c8c8");
}

function isValid(value) {
	if (isNaN(value))
		return false;
	if (!isNaN(q.maxValue) && value > q.maxValue)
		return false;
	if (!isNaN(q.minValue) && value < q.minValue)
		return false;

	return true;
}

function makeStars(length) {
	return new Array(length + 1).join("*");
}

function setText(text) {
	actualText = text;

	if (text !== undefined && webMI.query["password"] == "Yes")
		text = makeStars(cutUnit(text).length) + q.unit;

	webMI.gfx.setText("textValue", text);
}

for (var i in numbers)
	q[numbers[i]] = parseFloat(q[numbers[i]]);

q.unit = (q.unit != "") ? " " + q.unit : q.unit;

setButtonEnabled("btnOk", isValid(
	parseFloat(webMI.query.value)
));
setText(webMI.query.value + " " + webMI.query.unit);

function cutUnit(text) {
	if (q.unit.length == 0) return text;
	return text.substr(0, text.indexOf(q.unit));
}

var mousedowns = [
	'zero', 'one', 'two', 'three', 'four',
	'five', 'six', 'seven', 'eight', 'nine'
];

var mouseFunction = function(mouse, group, color) {
	var _func = function(e) {
		if (group == "ok" && !isOkButtonEnabled)
			return;

		webMI.gfx.setFillOpacity(group, color);
	};

	webMI.addEvent(group, mouse, _func);

	if (mouse == 'mouseup')
		webMI.addEvent(group, 'mouseout', _func);
};

var setFunction = function (group, item, number) {

	webMI.addEvent(group, 'click', function(e) {
		var val = cutUnit(actualText) + number;
		var minus = (val.indexOf('-') == -1) ? 0 : 1;
		var indexOfDec = val.indexOf(decSeparator);
		var digitsAfter = val.substr(indexOfDec + 1).length;
		var digitsBefore = val.substr(minus, indexOfDec - minus).length;

		if (indexOfDec == -1) {
			digitsBefore = digitsAfter - minus;
			digitsAfter = 0;
		}

		if (digitsBefore > q.digitsBeforePoint || digitsAfter > q.digitsAfterPoint)
			return;

		setButtonEnabled("btnOk", isValid(
			parseFloat(val)
		));
		setText(val + q.unit);
	});

};

for (var i=0; i < mousedowns.length; i++) {
	mouseFunction('mousedown', mousedowns[i], 0.5);
	mouseFunction('mouseup', mousedowns[i], 0);
	setFunction(mousedowns[i], 'btn' + i, i);
}

mouseFunction('mousedown', 'cancel', 0.5);
mouseFunction('mousedown', 'ok', 0.5);
mouseFunction('mousedown', 'minus', 0.5);
mouseFunction('mousedown', 'comma', 0.5);
//mouseFunction('mousedown', 'del', 0.5);

var delDown;

webMI.addEvent('del', 'mousedown', function(e) {
	webMI.gfx.setFillOpacity('del', 0.5);
	delDown = setTimeout(function() {
		setButtonEnabled("btnOk", false);
		setText(' ' + q.unit);
	}, 1500);
});

mouseFunction('mouseup', 'cancel', 0);
mouseFunction('mouseup', 'ok', 0);
mouseFunction('mouseup', 'minus', 0);
mouseFunction('mouseup', 'comma', 0);
//mouseFunction('mouseup', 'del', 0);

var delMouseUp = function(e) {
	webMI.gfx.setFillOpacity('del', 0);
	clearTimeout(delDown);
};

webMI.addEvent('del', 'mouseup', delMouseUp);
webMI.addEvent('del', 'mouseout', delMouseUp);

webMI.addEvent('minus', 'click', function(e) {
	var textValue = cutUnit(actualText);
	var value = (-1) * parseFloat(textValue);

	if (isNaN(value))
		return;

	setButtonEnabled("btnOk", isValid(value));
	setText(value + q.unit);
});



webMI.addEvent('del', 'click', function(e) {
	var text = cutUnit(actualText);
	text = text.substr(0, text.length-1) + q.unit;

	setButtonEnabled("btnOk", isValid(
		parseFloat(text)
	));
	setText(text);
});



webMI.addEvent('cancel', 'click', function(e) {
	webMI.display.closeWindow();
});



webMI.addEvent('ok', 'click', function(e) {
	if (!isOkButtonEnabled)
		return;

	if (q.queryConfirm == 'true' && !confirm(q.queryConfirmText)) return;

	var value = parseFloat(cutUnit(actualText));

	if (q.target != undefined) {
		webMI.data.write(q.target, value);
	}

	webMI.trigger.fire("valuechanged", value, "");

	if (q.trigger)
		webMI.trigger.fire(q.trigger, value);

	webMI.display.closeWindow();
});



webMI.addEvent('comma', 'click', function(e) {
	var textValue = cutUnit(actualText);

	if (textValue.indexOf(decSeparator) == -1) textValue += decSeparator;

	setText(textValue + q.unit);
});



]]></script>
</svg>
